<html><head><link rel=stylesheet type="text/css" href="../libref.css"><title>advlite.h</title></head><body>
<table class=ban><tr><td><h1>advlite.h</h1><td align=right><a href="../file/advlite.h.html">documentation</a></table><pre>
<a name="1"></a>#charset "us-ascii"
<a name="2"></a>
<a name="3"></a>/* 
<a name="4"></a> *   Copyright (c) 2000, 2006 Michael J. Roberts.  All Rights Reserved. 
<a name="5"></a> *   
<a name="6"></a> *   TADS 3 Library - main header
<a name="7"></a> *   
<a name="8"></a> *   This file provides definitions of macros, properties, and other
<a name="9"></a> *   identifiers used throughout the library and in game source.
<a name="10"></a> *   
<a name="11"></a> *   Each source code file in the library and in a game should generally
<a name="12"></a> *   #include this header near the top of the source file.  
<a name="13"></a> */
<a name="14"></a>
<a name="15"></a>#ifndef ADV3LITE_H
<a name="16"></a>#define ADV3LITE_H
<a name="17"></a>
<a name="18"></a>/* ------------------------------------------------------------------------ */
<a name="19"></a>/*
<a name="20"></a> *   Include the system headers that we depend upon.  We include these here
<a name="21"></a> *   so that each game source file will pick up the same set of system
<a name="22"></a> *   headers in the same order, which is important for intrinsic function
<a name="23"></a> *   set definitions.  
<a name="24"></a> */
<a name="25"></a>#include &lt;tads.h&gt;
<a name="26"></a>#include &lt;tok.h&gt;
<a name="27"></a>#include &lt;t3.h&gt;
<a name="28"></a>#include &lt;vector.h&gt;
<a name="29"></a>#include &lt;strbuf.h&gt;
<a name="30"></a>#include &lt;file.h&gt;
<a name="31"></a>#include &lt;dict.h&gt;
<a name="32"></a>#include &lt;bignum.h&gt;
<a name="33"></a>#include &lt;gramprod.h&gt;
<a name="34"></a>#include &lt;strcomp.h&gt;
<a name="35"></a>
<a name="36"></a>
<a name="37"></a>/* ------------------------------------------------------------------------ */
<a name="38"></a>/*
<a name="39"></a> *   Turn on sourceTextGroup property generation in the compiler.  (This lets
<a name="40"></a> *   us determine which module defined an object, and the order of the module
<a name="41"></a> *   in the overall project build.  We use this for determining the
<a name="42"></a> *   precedence of certain items based on their definition order in the
<a name="43"></a> *   source code.)  
<a name="44"></a> */
<a name="45"></a>#pragma sourceTextGroup(on)
<a name="46"></a>/* ------------------------------------------------------------------------ */
<a name="47"></a>
<a name="48"></a>/* ------------------------------------------------------------------------ */
<a name="49"></a>/*
<a name="50"></a> *   The '+' property sets an object's location to the lexically preceding
<a name="51"></a> *   object. 
<a name="52"></a> */
<a name="53"></a>+ property location;
<a name="54"></a>
<a name="55"></a>
<a name="56"></a>/*
<a name="57"></a> *   The VerbRule macro starts the definition of a verb grammar rule.  The
<a name="58"></a> *   tag is just an identifying name for the rule, so that you can refer to
<a name="59"></a> *   it with 'replace' or 'modify'.  
<a name="60"></a> */
<a name="61"></a>#define VerbRule(tag)  grammar predicate(tag):
<a name="62"></a>
<a name="63"></a>/*
<a name="64"></a> *   Verb rule noun phrase macros.  These are convenience macros for
<a name="65"></a> *   specifying the most common noun phrase slots in the grammar templates
<a name="66"></a> *   for verb rules.  
<a name="67"></a> */
<a name="68"></a>#define singleDobj     singleNoun-&gt;dobjMatch
<a name="69"></a>#define singleIobj     singleNoun-&gt;iobjMatch
<a name="70"></a>#define singleAcc      singleNoun-&gt;accMatch
<a name="71"></a>#define singleAobj     singleNoun-&gt;accMatch
<a name="72"></a>#define multiDobj      nounList-&gt;dobjMatch
<a name="73"></a>#define multiIobj      nounList-&gt;iobjMatch
<a name="74"></a>#define accList        nounList-&gt;accMatch
<a name="75"></a>#define aobjList       nounList-&gt;accMatch
<a name="76"></a>#define multiAcc       nounList-&gt;accMatch
<a name="77"></a>#define multiAobj      nounList-&gt;accMatch
<a name="78"></a>#define numberDobj     numberPhrase-&gt;dobjMatch
<a name="79"></a>#define topicDobj      topicPhrase-&gt;dobjMatch
<a name="80"></a>#define topicIobj      topicPhrase-&gt;iobjMatch
<a name="81"></a>#define topicAcc       topicPhrase-&gt;accMatch
<a name="82"></a>#define topicAobj      topicPhrase-&gt;accMatch
<a name="83"></a>#define literalDobj    literalPhrase-&gt;dobjMatch
<a name="84"></a>#define literalIobj    literalPhrase-&gt;iobjMatch
<a name="85"></a>#define literalAcc     literalPhrase-&gt;accMatch
<a name="86"></a>#define literalAobj    literalPhrase-&gt;accMatch
<a name="87"></a>#define singleDir      directionName-&gt;dirMatch
<a name="88"></a>#define numericDobj    numberPhrase -&gt; dobjMatch
<a name="89"></a>#define numericIobj    numberPhrase -&gt; iobjMatch
<a name="90"></a>#define numericAcc     numberPhrase -&gt; accMatch
<a name="91"></a>#define numericAobj    numberPhrase -&gt; accMatch
<a name="92"></a>
<a name="93"></a>/* Also add a couple of synonyms familiar froma adv3 */
<a name="94"></a>#define dobjList      nounList-&gt;dobjMatch
<a name="95"></a>#define iobjList      nounList-&gt;iobjMatch
<a name="96"></a>
<a name="97"></a>/* ------------------------------------------------------------------------ */
<a name="98"></a>/*
<a name="99"></a> *   Establish the default dictionary for the game's player command parser
<a name="100"></a> *   vocabulary.
<a name="101"></a> */
<a name="102"></a>dictionary cmdDict;
<a name="103"></a>
<a name="104"></a>/*
<a name="105"></a> *   The standard parts of speech for the dictionary.
<a name="106"></a> */
<a name="107"></a>dictionary property noun, nounApostS;
<a name="108"></a>
<a name="109"></a>
<a name="110"></a>/* ------------------------------------------------------------------------ */
<a name="111"></a>/*
<a name="112"></a> *   Flags for matching noun phrases during parsing.  These are bit flags, so
<a name="113"></a> *   they can be combined with '|' (bitwise OR).
<a name="114"></a> *   
<a name="115"></a> *   Note that the arithmetic values also matter: the values are in order of
<a name="116"></a> *   priority for noun phrase matches.  That is, a higher arithmetic value is
<a name="117"></a> *   a better match.  The best match is one with no truncation and no
<a name="118"></a> *   approximation, so that will have the highest arithmetic value when you
<a name="119"></a> *   combine those two bit flags.  The next best is character approximation
<a name="120"></a> *   but no truncation - truncation is more important than approximation, so
<a name="121"></a> *   it has a higher arithmetic value.  
<a name="122"></a> */
<a name="123"></a>
<a name="124"></a>/* matched a preposition (the phrase contains at least one preposition) */
<a name="125"></a>#define MatchPrep      0x0001
<a name="126"></a>
<a name="127"></a>/* 
<a name="128"></a> *   matched a weak token (which we'll treat as equivalent to matchimg a
<a name="129"></a> *   preposition).
<a name="130"></a> */
<a name="131"></a>#define MatchWeak      0x0001
<a name="132"></a>
<a name="133"></a>/* matched an adjective (the phrase contains at least one adjective) */
<a name="134"></a>#define MatchAdj       0x0002
<a name="135"></a>
<a name="136"></a>/* matched a noun (the phrase contains at least one noun word) */
<a name="137"></a>#define MatchNoun      0x0004
<a name="138"></a>
<a name="139"></a>/* matched a plural (the phrase contains at least one plural word) */
<a name="140"></a>#define MatchPlural    0x0008
<a name="141"></a>
<a name="142"></a>/* matched a phrase */
<a name="143"></a>#define MatchPhrase    0x0010 
<a name="144"></a>
<a name="145"></a>/* mask to select only the part-of-speech flags */
<a name="146"></a>#define MatchPartMask  0x0FFF
<a name="147"></a>
<a name="148"></a>
<a name="149"></a>/* 
<a name="150"></a> *   all words were matched WITHOUT character approximations (such as
<a name="151"></a> *   matching 'a' to 'a-umlaut') 
<a name="152"></a> */
<a name="153"></a>#define MatchNoApprox  0x1000
<a name="154"></a>
<a name="155"></a>/* all words were matched WITHOUT truncation */
<a name="156"></a>#define MatchNoTrunc   0x2000
<a name="157"></a>
<a name="158"></a>/* mask to select only the match-strength flags */
<a name="159"></a>#define MatchStrengthMask  0xF000
<a name="160"></a>
<a name="161"></a>/* ------------------------------------------------------------------------ */
<a name="162"></a>/*
<a name="163"></a> *   Flags for object selection during parsing.  These flags reflect how well
<a name="164"></a> *   an object matched a noun phrase during the resolution process.  
<a name="165"></a> */
<a name="166"></a>
<a name="167"></a>/* 
<a name="168"></a> *   The noun phrase required disambiguation, because more than one object
<a name="169"></a> *   was in scope that matched the noun phrase.  We were able to figure out
<a name="170"></a> *   which one(s) the player meant from context, without having to ask the
<a name="171"></a> *   player for help.
<a name="172"></a> *   
<a name="173"></a> *   For example, there are two doors in the room, one open and one closed.
<a name="174"></a> *   The player types OPEN DOOR.  It's fairly obvious that they must be
<a name="175"></a> *   talking about the closed door.  So, we choose that object and set the
<a name="176"></a> *   Disambig flag.
<a name="177"></a> *   
<a name="178"></a> *   (Note that this flag specifically does NOT mean that we had to ask the
<a name="179"></a> *   user for help with the dreaded "Which do you mean..." question.  It's
<a name="180"></a> *   kind of the opposite: it means that we had a noun phrase that was
<a name="181"></a> *   initially ambiguous, but that we managed to disambiguate it on our own.
<a name="182"></a> *   When we get the user involved, there's ambiguity *before* we ask the
<a name="183"></a> *   question, but the user's response removes the ambiguity by telling us
<a name="184"></a> *   exactly which alternative they intended.  This flag indicates that we
<a name="185"></a> *   made an educated guess about what the user must have intended, without
<a name="186"></a> *   asking.  The flag lets the parser tell the player about the guess, which
<a name="187"></a> *   is desirable because the guess is sometimes wrong.  
<a name="188"></a> */
<a name="189"></a>#define SelDisambig         0x0001
<a name="190"></a>
<a name="191"></a>/*
<a name="192"></a> *   This object was chosen arbitrarily from a larger set, because the noun
<a name="193"></a> *   phrase construction says we should do so.  This flag is set when the
<a name="194"></a> *   noun phrase is something TAKE A BOOK or TAKE ANY OF THE BOOKS.  
<a name="195"></a> */
<a name="196"></a>#define SelArbitrary        0x0002
<a name="197"></a>
<a name="198"></a>/*
<a name="199"></a> *   The noun phrase that we matched was a manifestly plural construction,
<a name="200"></a> *   such as TAKE ALL or TAKE THE BOOKS.  
<a name="201"></a> */
<a name="202"></a>#define SelPlural           0x0004
<a name="203"></a>
<a name="204"></a>/*
<a name="205"></a> *   We selected an object as a default.  This is set when the player leaves
<a name="206"></a> *   out a noun phrase, but we can guess what was probably meant based on
<a name="207"></a> *   context: e.g., ASK ABOUT THE HOUSE is probably directed to Bob if Bob is
<a name="208"></a> *   the only person nearby.  
<a name="209"></a> */
<a name="210"></a>#define SelDefault          0x0008
<a name="211"></a>
<a name="212"></a>/*
<a name="213"></a> *   This object was set internally by the program; it did not come from
<a name="214"></a> *   parsing any player input.  This generally means that the whole command
<a name="215"></a> *   was constructed by the program, to handle an event or other internal
<a name="216"></a> *   processing, rather than by parsing player input.  
<a name="217"></a> */
<a name="218"></a>#define SelProg             0x1000
<a name="219"></a>
<a name="220"></a>/* ------------------------------------------------------------------------ */
<a name="221"></a>/*
<a name="222"></a> *   readMainCommandTokens() phase identifiers.  We define a separate code
<a name="223"></a> *   for each kind of call to readMainCommandTokens() so that we can do any
<a name="224"></a> *   special token processing that depends on the type of command we're
<a name="225"></a> *   reading.
<a name="226"></a> *   
<a name="227"></a> *   The library doesn't use the phase information itself for anything.
<a name="228"></a> *   These phase codes are purely for the author's use in writing
<a name="229"></a> *   pre-parsing functions and for differentiating prompts for the different
<a name="230"></a> *   types of input, as needed.
<a name="231"></a> *   
<a name="232"></a> *   Games that read additional response types of their own are free to add
<a name="233"></a> *   their own enums to identify the additional phases.  Since the library
<a name="234"></a> *   doesn't need the phase information for anything internally, it won't
<a name="235"></a> *   confuse the library at all to add new game-specific phase codes.  
<a name="236"></a> */
<a name="237"></a>
<a name="238"></a>/* reading a normal command line */
<a name="239"></a>enum rmcCommand;
<a name="240"></a>
<a name="241"></a>/* reading an unknown word response, to check for an "oops" command */
<a name="242"></a>enum rmcOops;
<a name="243"></a>
<a name="244"></a>/* reading a response to a prompt for a missing object phrase */
<a name="245"></a>enum rmcAskObject;
<a name="246"></a>
<a name="247"></a>/* reading a response to a prompt for a missing literal phrase */
<a name="248"></a>enum rmcAskLiteral;
<a name="249"></a>
<a name="250"></a>/* reading a response to an interactive disambiguation prompt */
<a name="251"></a>enum rmcDisambig;
<a name="252"></a>
<a name="253"></a>
<a name="254"></a>/* ------------------------------------------------------------------------ */
<a name="255"></a>/* 
<a name="256"></a> *   A couple of utility macros we use internally for turning macro values
<a name="257"></a> *   into strings.  STRINGIZE(x) expands any macros in its argument and then
<a name="258"></a> *   turns the result into a single-quoted string, which can then be used in
<a name="259"></a> *   regular program text or in directives that evaluate constant
<a name="260"></a> *   expressions, such as #if.  (STRINGIZE is the real macro; _STRINGIZE is
<a name="261"></a> *   needed to force expansion of any macros in the argument, which is
<a name="262"></a> *   required because of the weird ANSI C expansion-order rules, and which
<a name="263"></a> *   works because of same.)  
<a name="264"></a> */
<a name="265"></a>#define _STRINGIZE(x) #@x
<a name="266"></a>#define STRINGIZE(x)  _STRINGIZE(x)
<a name="267"></a>
<a name="268"></a>
<a name="269"></a>
<a name="270"></a>
<a name="271"></a>/* ------------------------------------------------------------------------ */
<a name="272"></a>/*
<a name="273"></a> *   Parser global variables giving information on the command currently
<a name="274"></a> *   being performed.  These are valid through doAction processing.  These
<a name="275"></a> *   should never be changed except by the parser.
<a name="276"></a> */
<a name="277"></a>
<a name="278"></a>/* the actor performing the current command */
<a name="279"></a>#define gActor (libGlobal.curActor)
<a name="280"></a>
<a name="281"></a>/*
<a name="282"></a> *   For convenience, define some macros that return the current direct and
<a name="283"></a> *   indirect objects from the current action.  The library only uses direct
<a name="284"></a> *   and indirect objects, so games that define additional command objects
<a name="285"></a> *   will have to add their own similar macros for those.  
<a name="286"></a> */
<a name="287"></a>#define gDobj (gAction.curDobj)
<a name="288"></a>#define gIobj (gAction.curIobj)
<a name="289"></a>#define gLiteral (gAction.literal)
<a name="290"></a>#define gNumber (gAction.num)
<a name="291"></a>
<a name="292"></a>
<a name="293"></a>/* the Action object of the command being executed */
<a name="294"></a>#define gAction (libGlobal.curAction)
<a name="295"></a>#define gCommand (libGlobal.curCommand)
<a name="296"></a>
<a name="297"></a>#define gTentativeDobj (gCommand.dobjs.mapAll({x: x.obj}).toList)
<a name="298"></a>#define gTentativeIobj (gCommand.iobjs.mapAll({x: x.obj}).toList)
<a name="299"></a>
<a name="300"></a>/* 
<a name="301"></a> *   the probable Action objects of the command being executed for use in verify routines when
<a name="302"></a> *   resolution of both objects may not be complete. If the gDobj or gIobj is non-nil, use that,
<a name="303"></a> *   otherwise use the first object in the tentative resolution list if the list has any items,
<a name="304"></a> *   otherwisse evaluate to failVerifyObj.
<a name="305"></a> */
<a name="306"></a>#define gVerifyDobj (gDobj ?? (gTentativeDobj.length &gt; 0 ? gTentativeDobj[1] : failVerifyObj))
<a name="307"></a>#define gVerifyIobj (gIobj ?? (gTentativeIobj.length &gt; 0 ? gTentativeIobj[1] : failVerifyObj))
<a name="308"></a>
<a name="309"></a>/* 
<a name="310"></a> *   An alternative way of dealing with the potential object not yet resolved problem, by testing
<a name="311"></a> *   whether any of the objects in lst are in the Tentative Object List.
<a name="312"></a> */
<a name="313"></a>#define gTentativeDobjIn(lst)  (gTentativeDobj.overlapsWith(lst))
<a name="314"></a>#define gTentativeIobjIn(lst)  (gTentativeIobj.overlapsWith(lst))
<a name="315"></a>
<a name="316"></a>/* The previous action and command */
<a name="317"></a>#define gLastAction (libGlobal.lastAction)
<a name="318"></a>#define gLastCommand (libGlobal.lastCommand)
<a name="319"></a>
<a name="320"></a>/*
<a name="321"></a> *   Determine if the current global action is the specified action.  Only
<a name="322"></a> *   the action prefix is needed - so use "Take" rather than "TakeAction"
<a name="323"></a> *   here.
<a name="324"></a> *   
<a name="325"></a> *   This tests to see if the current global action is an instance of the
<a name="326"></a> *   given action class - we test that it's an instance rather than the
<a name="327"></a> *   action class itself because the parser creates an instance of the
<a name="328"></a> *   action when it matches the action's syntax.  
<a name="329"></a> */
<a name="330"></a>#define gActionIs(action) \
<a name="331"></a>    (gAction != nil &amp;&amp; gAction.ofKind(action))
<a name="332"></a>
<a name="333"></a>/* is the current global action ANY of the specified actions? */
<a name="334"></a>#define gActionIn(action...) \
<a name="335"></a>    (gAction != nil \
<a name="336"></a>     &amp;&amp; (action#foreach/gAction.ofKind(action)/||/))
<a name="337"></a>
<a name="338"></a>/* is the current action a Travel action going dirn */
<a name="339"></a>#define gTravelActionIs(dirn) \
<a name="340"></a>  (gAction != nil &amp;&amp; gAction.ofKind(Travel) &amp;&amp; gAction.direction == dirn ## Dir)
<a name="341"></a>
<a name="342"></a>/* the list of objects involved in the action just completed */
<a name="343"></a>#define gActionList (nilToList(gCommand.action.actionList))
<a name="344"></a>
<a name="345"></a>/* a displaying string version of the above */
<a name="346"></a>#define gActionListStr makeListStr(gCommand.action.reportList, &amp;theName)
<a name="347"></a>
<a name="348"></a>/* 
<a name="349"></a> *   an object that is singular or plural according to whether gActionList
<a name="350"></a> *   represents a single object of a plurality of objects, and which picks
<a name="351"></a> *   up the correct gender if there is only a single object.
<a name="352"></a> */
<a name="353"></a>
<a name="354"></a>#define gActionListObj (object: Thing \
<a name="355"></a>             { \
<a name="356"></a>                 plural = (gAction.reportList.length &gt; 1 || \
<a name="357"></a>                           gAction.reportList[1].plural); \
<a name="358"></a>                 isIt = (gAction.reportList.length == 1 ? \
<a name="359"></a>                    gAction.reportList[1].isIt : nil);\
<a name="360"></a>                 isHim = (gAction.reportList.length == 1 ? \
<a name="361"></a>                    gAction.reportList[1].isHim : nil);\
<a name="362"></a>                 isHer = (gAction.reportList.length == 1 ? \
<a name="363"></a>                    gAction.reportList[1].isHer : nil);\
<a name="364"></a>                 name = gActionListStr; \
<a name="365"></a>                 qualified = true; \
<a name="366"></a>             } )
<a name="367"></a>
<a name="368"></a>
<a name="369"></a>/* ------------------------------------------------------------------------ */
<a name="370"></a>/*
<a name="371"></a> *   Miscellaneous macros
<a name="372"></a> */
<a name="373"></a>
<a name="374"></a>/* get the current player character Actor object */
<a name="375"></a>#define gPlayerChar (libGlobal.playerChar)
<a name="376"></a>
<a name="377"></a>/* get the player character's location */
<a name="378"></a>#define gLocation (getPlayerChar().location)
<a name="379"></a>
<a name="380"></a>/* get the current turn count */
<a name="381"></a>#define gTurns (libGlobal.totalTurns)
<a name="382"></a>
<a name="383"></a>/* 
<a name="384"></a> *   get the player character's current room (which may or may not be the same
<a name="385"></a> *   as his/her location)
<a name="386"></a> */
<a name="387"></a>#define gRoom (getPlayerChar().getOutermostRoom)
<a name="388"></a>
<a name="389"></a>/* Get the current actor's curren room (which may not be the same as its location) */
<a name="390"></a>#define gActorRoom (gActor.getOutermostRoom)
<a name="391"></a>
<a name="392"></a>#define objFor(which, action) propertyset '*' ## #@which ## #@action
<a name="393"></a>
<a name="394"></a>#define dobjFor(action) objFor(Dobj, action)
<a name="395"></a>#define iobjFor(action) objFor(Iobj, action)
<a name="396"></a>#define gTopic (gAction.curTopic)
<a name="397"></a>#define gTopicText (gTopic.getTopicText)
<a name="398"></a>#define gTopicMatch (gTopic.getBestMatch)
<a name="399"></a>
<a name="400"></a>#define reportAfter(msg) gCommand.afterReports += msg
<a name="401"></a>#define reportPostImplicit(msg) gCommand.postImplicitReports += msg
<a name="402"></a>
<a name="403"></a>/* 
<a name="404"></a> *   Defined for the sake of adv3 users moving to adv3Lite, who may be more used to using
<a name="405"></a> *   mainReport() in a similar context.
<a name="406"></a> */
<a name="407"></a>#define mainReport(msg, args...) actionReport(msg, ##args)
<a name="408"></a>
<a name="409"></a>#define sLoc(which) subLocation = &amp;remap##which
<a name="410"></a>
<a name="411"></a>#define UsePronoun 1
<a name="412"></a>
<a name="413"></a>
<a name="414"></a>
<a name="415"></a>/*
<a name="416"></a> *   Treat an object definition as equivalent to another object definition.
<a name="417"></a> *   These can be used immediately after a dobjFor() or iobjFor() to treat
<a name="418"></a> *   the first action as though it were the second.  So, if the player types
<a name="419"></a> *   "search box", and we want to treat the direct object the same as for
<a name="420"></a> *   "look in box", we could make this definition for the box:
<a name="421"></a> *   
<a name="422"></a> *   dobjFor(Search) asDobjFor(LookIn)
<a name="423"></a> *   
<a name="424"></a> *   Note that no semicolon is needed after this definition, and that this
<a name="425"></a> *   definition is completely in lieu of a regular property set for the
<a name="426"></a> *   object action.
<a name="427"></a> *   
<a name="428"></a> *   In general, a mapping should NOT change the role of an object:
<a name="429"></a> *   dobjFor(X) should not usually be mapped using asIobjFor(Y), and
<a name="430"></a> *   iobjFor(X) shouldn't be mapped using asDobjFor(Y).  The problem with
<a name="431"></a> *   changing the role is that the handler routines often assume that the
<a name="432"></a> *   object is actually in the role for which the handler was written; a
<a name="433"></a> *   verify handler might refer to '{dobj}' in generating a message, for
<a name="434"></a> *   example, so reversing the roles would give the wrong object in the role.
<a name="435"></a> *   
<a name="436"></a> *   Role reversals should always be avoided, but can be used if necessary
<a name="437"></a> *   under conditions where all of the code involved in the TARGET of the
<a name="438"></a> *   mapping can be carefully controlled to ensure that it doesn't make
<a name="439"></a> *   assumptions about object roles, but only references 'self'.  Reversing
<a name="440"></a> *   roles in a mapping should never be attempted in general-purpose library
<a name="441"></a> *   code, because code based on the library could override the target of the
<a name="442"></a> *   role-reversing mapping, and the override could fail to observe the
<a name="443"></a> *   restrictions on object role references.
<a name="444"></a> *   
<a name="445"></a> *   Note that role reversals can almost always be handled with other
<a name="446"></a> *   mechanisms that handle reversals cleanly.  Always consider Doer.doInstead()
<a name="447"></a> *   first when confronted with a situation that seems to call for a
<a name="448"></a> *   role-reversing asObjFor() mapping, as doInstead() specifically allows for
<a name="449"></a> *   object role changes.  
<a name="450"></a> */
<a name="451"></a>#define asObjFor(obj, Action) \
<a name="452"></a>    { \
<a name="453"></a>        preCond { return preCond##obj##Action; } \
<a name="454"></a>        verify() { verify##obj##Action; } \
<a name="455"></a>        remap() { return remap##obj##Action; } \
<a name="456"></a>        check() { check##obj##Action; } \
<a name="457"></a>        action() { action##obj##Action; } \
<a name="458"></a>        report() { report##obj##Action; } \
<a name="459"></a>    }
<a name="460"></a>
<a name="461"></a>#define asDobjFor(action) asObjFor(Dobj, action)
<a name="462"></a>#define asIobjFor(action) asObjFor(Iobj, action)
<a name="463"></a>
<a name="464"></a>/* 
<a name="465"></a> *   Define mappings of everything except the action.  This can be used in
<a name="466"></a> *   cases where we want to pick up the verification, preconditions, and
<a name="467"></a> *   check routines from another handler, but not the action.  This is often
<a name="468"></a> *   useful for two-object verbs where the action processing is entirely
<a name="469"></a> *   provided by one or the other object, so applying it to both would be
<a name="470"></a> *   redundant.  
<a name="471"></a> */
<a name="472"></a>#define asObjWithoutActionFor(obj, Action) \
<a name="473"></a>    { \
<a name="474"></a>        preCond { return preCond##obj##Action; } \
<a name="475"></a>        verify() { verify##obj##Action; } \
<a name="476"></a>        remap() { return remap##obj##Action(); } \
<a name="477"></a>        check() { check##obj##Action; } \
<a name="478"></a>        action() {  } \
<a name="479"></a>    }
<a name="480"></a>
<a name="481"></a>#define asDobjWithoutActionFor(action) asObjWithoutActionFor(Dobj, action)
<a name="482"></a>#define asIobjWithoutActionFor(action) asObjWithoutActionFor(Iobj, action)
<a name="483"></a>
<a name="484"></a>#define asObjWithoutVerifyFor(obj, Action) \
<a name="485"></a>    { \
<a name="486"></a>        preCond { return preCond##obj##Action; } \
<a name="487"></a>        remap() { return remap##obj##Action(); } \
<a name="488"></a>        check() { check##obj##Action; } \
<a name="489"></a>        action() { action##obj##Action(); } \
<a name="490"></a>        report() { report##obj##Action(); } \
<a name="491"></a>    }
<a name="492"></a>
<a name="493"></a>#define asDobjWithoutVerifyFor(action) asObjWithoutVerifyFor(Dobj, action)
<a name="494"></a>#define asIobjWithoutVerifyFor(action) asObjWithoutVerifyFor(Iobj, action)
<a name="495"></a>
<a name="496"></a>#define askForDobj(action)  askMissingObject(action, DirectObject)
<a name="497"></a>#define askForIobj(action)  askMissingObject(action, IndirectObject)
<a name="498"></a>#define askForAobj(action)  askMissingObject(action, AccessoryObject)
<a name="499"></a>#define askForAcc(action)   askMissingObject(action, AccessoryObject) 
<a name="500"></a>
<a name="501"></a>#define askForDobjX(action)  askMissingObject(action, DirectObject, nil)
<a name="502"></a>#define askForIobjX(action)  askMissingObject(action, IndirectObject, nil)
<a name="503"></a>#define askForAobjX(action)  askMissingObject(action, AccessoryObject, nil)
<a name="504"></a>#define askForAccX(action)   askMissingObject(action, AccessoryObject, nil) 
<a name="505"></a>
<a name="506"></a>/*  Convenience macros for synthesizing travel in a given compass direction */
<a name="507"></a>
<a name="508"></a>#define goInstead(dirn) doInstead(Go, dirn##Dir)
<a name="509"></a>#define goNested(dirn) doNested(Go, dirn##Dir)
<a name="510"></a>
<a name="511"></a>
<a name="512"></a>
<a name="513"></a>
<a name="514"></a>#define asExit(dir) : UnlistedProxyConnector { direction = dir##Dir }
<a name="515"></a>#define asExitListed(dir) : UnlistedProxyConnector { direction = dir##Dir  isConnectorListed = true}
<a name="516"></a>#define ulExit(dest) : UnlistedTravelConnector { destination = dest }
<a name="517"></a>#define ulMsgExit(dest, msg) : UnlistedTravelConnector { \
<a name="518"></a>    destination = dest \
<a name="519"></a>    travelDesc = msg   }
<a name="520"></a>#define tcMsg(dest, msg) : TravelConnector { \
<a name="521"></a>    destination = dest \
<a name="522"></a>    travelDesc = msg   }    
<a name="523"></a>
<a name="524"></a>/* ------------------------------------------------------------------------ */
<a name="525"></a>/*
<a name="526"></a> *   Define an action with the given base class.  This adds the *Action
<a name="527"></a> *   suffix to the given root name, and defines a class with the given base
<a name="528"></a> *   class.  We also define the baseActionClass property to refer to myself;
<a name="529"></a> *   this is the canonical class representing the action for all subclasses.
<a name="530"></a> *   This information is useful because a language module might define
<a name="531"></a> *   several grammar rule subclasses for the given class; this lets us
<a name="532"></a> *   relate any instances of those various subclasses back to this same
<a name="533"></a> *   canonical class for the action if necessary.  
<a name="534"></a> */
<a name="535"></a>
<a name="536"></a>/* 
<a name="537"></a> *   Define an action OBJECT with the given name inheriting from the given base
<a name="538"></a> *   class, for use with the Mercury parser.
<a name="539"></a> */
<a name="540"></a>
<a name="541"></a>#define DefineAction(name, baseClass...) \
<a name="542"></a>    name: ##baseClass \
<a name="543"></a>    baseActionClass = name
<a name="544"></a>
<a name="545"></a>/*
<a name="546"></a> *   Define a "system" action.  System actions are meta-game commands, such
<a name="547"></a> *   as SAVE and QUIT, that generally operate the user interface and are not
<a name="548"></a> *   part of the game world.  
<a name="549"></a> */
<a name="550"></a>#define DefineSystemAction(name) \
<a name="551"></a>    DefineAction(name, SystemAction)
<a name="552"></a>
<a name="553"></a>/*
<a name="554"></a> *   Define a concrete IAction, given the root name for the action.  We'll
<a name="555"></a> *   automatically generate a class with name XxxAction. 
<a name="556"></a> */
<a name="557"></a>#define DefineIAction(name) \
<a name="558"></a>    DefineAction(name, IAction)
<a name="559"></a>
<a name="560"></a>/*
<a name="561"></a> *   Define a concrete TAction, given the root name for the action.  We'll
<a name="562"></a> *   automatically generate a class with name XxxAction, a verProp with name
<a name="563"></a> *   verXxx, a checkProp with name checkXxx, and an actionProp with name
<a name="564"></a> *   actionDobjXxx.  
<a name="565"></a> */
<a name="566"></a>#define DefineTAction(name) \
<a name="567"></a>    DefineTActionSub(name, TAction)
<a name="568"></a>
<a name="569"></a>/*
<a name="570"></a> *   Define a concrete TAction with a specific base class.  
<a name="571"></a> */
<a name="572"></a>#define DefineTActionSub(name, cls) \
<a name="573"></a>    DefineAction(name, cls) \
<a name="574"></a>    verDobjProp = &amp;verifyDobj##name \
<a name="575"></a>    remapDobjProp = &amp;remapDobj##name \
<a name="576"></a>    preCondDobjProp = &amp;preCondDobj##name \
<a name="577"></a>    checkDobjProp = &amp;checkDobj##name \
<a name="578"></a>    actionDobjProp  = &amp;actionDobj##name \
<a name="579"></a>    reportDobjProp = &amp;reportDobj##name \
<a name="580"></a>
<a name="581"></a>#define DefineLiteralTAction(name)\
<a name="582"></a>    DefineTActionSub(name, LiteralTAction)
<a name="583"></a>
<a name="584"></a>#define DefineLiteralAction(name)\
<a name="585"></a>    DefineAction(name, LiteralAction)
<a name="586"></a>
<a name="587"></a>#define DefineTopicTAction(name)\
<a name="588"></a>    DefineTActionSub(name, TopicTAction)
<a name="589"></a>
<a name="590"></a>#define DefineTopicAction(name)\
<a name="591"></a>    DefineAction(name, TopicAction)
<a name="592"></a>
<a name="593"></a>#define DefineNumericTAction(name)\
<a name="594"></a>    DefineTActionSub(name, NumericTAction)
<a name="595"></a>
<a name="596"></a>#define DefineNumericAction(name) \
<a name="597"></a>    DefineAction(name, NumericAction)
<a name="598"></a>
<a name="599"></a>
<a name="600"></a>/*
<a name="601"></a> *   Define a concrete TIAction, given the root name for the action.  We'll
<a name="602"></a> *   automatically generate a class with name XxxAction, a verDobjProp with
<a name="603"></a> *   name verDobjXxx, a verIobjProp with name verIobjxxx, a checkDobjProp
<a name="604"></a> *   with name checkDobjXxx, a checkIobjProp with name checkIobjXxx, an
<a name="605"></a> *   actionDobjProp with name actionDobjXxx, and an actionIobjProp with name
<a name="606"></a> *   actionIobjXxx.  
<a name="607"></a> */
<a name="608"></a>#define DefineTIAction(name) \
<a name="609"></a>    DefineTIActionSub(name, TIAction)
<a name="610"></a>
<a name="611"></a>/*
<a name="612"></a> *   Define a concrete TIAction with a specific base class.  
<a name="613"></a> */
<a name="614"></a>#define DefineTIActionSub(name, cls) \
<a name="615"></a>    DefineAction(name, cls) \
<a name="616"></a>    verDobjProp = &amp;verifyDobj##name \
<a name="617"></a>    verIobjProp = &amp;verifyIobj##name \
<a name="618"></a>    remapDobjProp = &amp;remapDobj##name \
<a name="619"></a>    remapIobjProp = &amp;remapIobj##name \
<a name="620"></a>    preCondDobjProp = &amp;preCondDobj##name \
<a name="621"></a>    preCondIobjProp = &amp;preCondIobj##name \
<a name="622"></a>    checkDobjProp = &amp;checkDobj##name \
<a name="623"></a>    checkIobjProp = &amp;checkIobj##name \
<a name="624"></a>    actionDobjProp  = &amp;actionDobj##name \
<a name="625"></a>    actionIobjProp = &amp;actionIobj##name \
<a name="626"></a>    reportDobjProp = &amp;reportDobj##name \
<a name="627"></a>    reportIobjProp = &amp;reportIobj##name \
<a name="628"></a>
<a name="629"></a>/* Shortcut macros for defining VerbRules and Actions together in a single statement. */
<a name="630"></a>#define DefineTVerb(name, gram, inf, partc) \
<a name="631"></a>    VerbRule(name)\
<a name="632"></a>    gram\
<a name="633"></a>    : VerbProduction\
<a name="634"></a>    action = name\
<a name="635"></a>    verbPhrase = inf + '/' + partc + 'what '\
<a name="636"></a>    missingQ = 'what do you want to ' + inf\
<a name="637"></a>    ;\
<a name="638"></a>    DefineTAction(name)
<a name="639"></a>
<a name="640"></a>#define DefineIVerb(name, gram, inf, partc)\
<a name="641"></a>    VerbRule(name)\
<a name="642"></a>    gram\
<a name="643"></a>    :VerbProduction \
<a name="644"></a>    action = name\
<a name="645"></a>    verbPhrase = inf + '/' + partc\
<a name="646"></a>    ;\
<a name="647"></a>    DefineIAction(name)
<a name="648"></a>
<a name="649"></a>#define DefineTIVerb(name, gram, inf, partc, prep) \
<a name="650"></a>    VerbRule(name)\
<a name="651"></a>    gram\
<a name="652"></a>    : VerbProduction\
<a name="653"></a>    action = name\
<a name="654"></a>    verbPhrase = inf + '/' + partc + ' what ' + '('+ #@prep + ' what)'\
<a name="655"></a>    missingQ = 'what do you want to ' + inf +';what do you want to ' + inf + ' it ' + #@prep\
<a name="656"></a>    iobjReply = prep##SingleNoun \
<a name="657"></a>    ;\
<a name="658"></a>    DefineTIAction(name)
<a name="659"></a>    
<a name="660"></a>#define DefineTVerbS(name, gram, inf, partc) \
<a name="661"></a>    VerbRule(name)\
<a name="662"></a>    gram\
<a name="663"></a>    : VerbProduction\
<a name="664"></a>    action = name\
<a name="665"></a>    verbPhrase = inf + '/' + partc + 'what '\
<a name="666"></a>    missingQ = 'what do you want to ' + inf\
<a name="667"></a>    dobjReply = singleNoun\
<a name="668"></a>    ;\
<a name="669"></a>    DefineTAction(name)
<a name="670"></a>
<a name="671"></a>#define DefineTIVerbS(name, gram, inf, partc, prep) \
<a name="672"></a>    VerbRule(name)\
<a name="673"></a>    gram\
<a name="674"></a>    : VerbProduction\
<a name="675"></a>    action = name\
<a name="676"></a>    verbPhrase = inf + '/' + partc + ' what ' + '('+ #@prep + ' what)'\
<a name="677"></a>    missingQ = 'what do you want to ' + inf +';what do you want to ' + inf + ' it ' + #@prep\
<a name="678"></a>    iobjReply = prep##SingleNoun \
<a name="679"></a>    dobjReply = singleNoun\
<a name="680"></a>    ;\
<a name="681"></a>    DefineTIAction(name)
<a name="682"></a>
<a name="683"></a>/* Macros to abbreviate the definitions of SpecialTRavelActions. */
<a name="684"></a>    
<a name="685"></a>#define DefSTA(action, prop) action : SpecialTravelAction travelProp = prop
<a name="686"></a>#define DefSTAVR(name, voc) VerbRule(name) voc :VerbProduction action = name 
<a name="687"></a>#define DefSpecialTravel(action, prop, voc) \
<a name="688"></a>    DefSTAVR(action, voc);\
<a name="689"></a>    DefSTA(action, prop)
<a name="690"></a>
<a name="691"></a>/*
<a name="692"></a> *   Modify a concrete TIAction to work with multimethods. This creates the base version of the
<a name="693"></a> *   three multimethods needed then sets the relevant methods of the TIAction to call the relevant
<a name="694"></a> *   multimethod.
<a name="695"></a> */   
<a name="696"></a>#define MMTIAction(name) \
<a name="697"></a>    verify ## name (Object dobj, Object iobj, Thing verobj) {} \
<a name="698"></a>    check ## name (Object dobj, Object iobj) {} \
<a name="699"></a>    action ## name (Object dobj, Object iobj) {} \
<a name="700"></a>    modify name \
<a name="701"></a>    mmVerify(dobj, iobj, verobj) { verify ## name (dobj, iobj, verobj); } \
<a name="702"></a>    mmCheck(dobj, iobj) { check ## name (dobj, iobj); } \
<a name="703"></a>    mmAction(dobj, iobj) { action ## name (dobj, iobj); }
<a name="704"></a>
<a name="705"></a>#define tvo Thing verobj
<a name="706"></a>
<a name="707"></a>/*
<a name="708"></a> *   The following macros relating to the TIAAction class are only relevant when
<a name="709"></a> *   the TIAAction extension is used. The macros are nevertheless included here
<a name="710"></a> *   for convenience when using the TIAAction extension.
<a name="711"></a> *
<a name="712"></a> *   Define a concrete TIAAction, given the root name for the action.  We'll
<a name="713"></a> *   automatically generate a class with name XxxAction, a verDobjProp with name
<a name="714"></a> *   verDobjXxx, a verIobjProp with name verIobjxxx, a checkDobjProp with name
<a name="715"></a> *   checkDobjXxx, a checkIobjProp with name checkIobjXxx, an actionDobjProp
<a name="716"></a> *   with name actionDobjXxx, and an actionIobjProp with name actionIobjXxx.
<a name="717"></a> */
<a name="718"></a>#define DefineTIAAction(name) \
<a name="719"></a>    DefineTIAActionSub(name, TIAAction)
<a name="720"></a>
<a name="721"></a>/*
<a name="722"></a> *   Define a concrete TIAction with a specific base class.  
<a name="723"></a> */
<a name="724"></a>#define DefineTIAActionSub(name, cls) \
<a name="725"></a>    DefineAction(name, cls) \
<a name="726"></a>    verDobjProp = &amp;verifyDobj##name \
<a name="727"></a>    verIobjProp = &amp;verifyIobj##name \
<a name="728"></a>    verAobjProp = &amp;verifyAobj##name \
<a name="729"></a>    remapDobjProp = &amp;remapDobj##name \
<a name="730"></a>    remapIobjProp = &amp;remapIobj##name \
<a name="731"></a>    remapAobjProp = &amp;remapAobj##name \
<a name="732"></a>    preCondDobjProp = &amp;preCondDobj##name \
<a name="733"></a>    preCondIobjProp = &amp;preCondIobj##name \
<a name="734"></a>    preCondAobjProp = &amp;preCondAobj##name \
<a name="735"></a>    checkDobjProp = &amp;checkDobj##name \
<a name="736"></a>    checkIobjProp = &amp;checkIobj##name \
<a name="737"></a>    checkAobjProp = &amp;checkAobj##name \
<a name="738"></a>    actionDobjProp  = &amp;actionDobj##name \
<a name="739"></a>    actionIobjProp = &amp;actionIobj##name \
<a name="740"></a>    actionAobjProp = &amp;actionAobj##name \
<a name="741"></a>    reportDobjProp = &amp;reportDobj##name \
<a name="742"></a>    reportIobjProp = &amp;reportIobj##name \
<a name="743"></a>    reportAobjProp = &amp;reportAobj##name \
<a name="744"></a>
<a name="745"></a>
<a name="746"></a>#define aobjFor(action) objFor(Aobj, action)
<a name="747"></a>#define asAobjFor(action) asObjFor(Aobj, action)
<a name="748"></a>#define accFor(action) objFor(Aobj, action)
<a name="749"></a>#define asAccFor(action) asObjFor(Aobj, action)
<a name="750"></a>#define gAobj gAction.curAobj
<a name="751"></a>#define gAcc gAction.curAobj
<a name="752"></a>
<a name="753"></a>
<a name="754"></a>/* 
<a name="755"></a> *   Macros for use in verify routines, returning various kinds of verify
<a name="756"></a> *   results
<a name="757"></a> */
<a name="758"></a>
<a name="759"></a>#define gVerifyList gAction.verifyList
<a name="760"></a>
<a name="761"></a>#define logical gAction.addVerifyResult (new VerifyResult(100, '', true, verobj))
<a name="762"></a>    
<a name="763"></a>#define illogical(msg) \
<a name="764"></a>    gAction.addVerifyResult(new VerifyResult(30, msg, nil, verobj))
<a name="765"></a>
<a name="766"></a>#define illogicalNow(msg) \
<a name="767"></a>    gAction.addVerifyResult(new VerifyResult(40, msg, nil, verobj))
<a name="768"></a>
<a name="769"></a>
<a name="770"></a>/* 
<a name="771"></a> *   IllogicalAlready doesn't do anything mush different from IllogicalNow in
<a name="772"></a> *   adv3Lite, but is supplied so that game authors familiar with adv3 can use
<a name="773"></a> *   it without getting a compilation error. It may also be slightly useful for
<a name="774"></a> *   documentary purposes to clarify why a verify routine in game code is ruling
<a name="775"></a> *   out an action. We now give it a slightly higher logical rank than illogicalNow().
<a name="776"></a> */
<a name="777"></a>#define illogicalAlready(msg) \
<a name="778"></a>    gAction.addVerifyResult(new VerifyResult(45, msg, nil, verobj))
<a name="779"></a>
<a name="780"></a>#define illogicalSelf(msg) \
<a name="781"></a>    gAction.addVerifyResult(new VerifyResult(20, msg, nil, verobj))
<a name="782"></a>
<a name="783"></a>#define logicalRank(score) \
<a name="784"></a>    gAction.addVerifyResult(new VerifyResult(score, '', true, verobj))
<a name="785"></a>
<a name="786"></a>#define inaccessible(msg) \
<a name="787"></a>    gAction.addVerifyResult(new VerifyResult(10, msg, nil, verobj))
<a name="788"></a>
<a name="789"></a>#define implausible(msg) \
<a name="790"></a>    gAction.addVerifyResult(new VerifyResult(35, msg, nil, verobj))
<a name="791"></a>
<a name="792"></a>#define nonObvious \
<a name="793"></a>    gAction.addVerifyResult(new VerifyResult(30, '', true, verobj, nil))
<a name="794"></a>
<a name="795"></a>#define dangerous \
<a name="796"></a>    gAction.addVerifyResult(new VerifyResult(90, '', true, verobj, nil))
<a name="797"></a>
<a name="798"></a>
<a name="799"></a>/* ------------------------------------------------------------------------ */
<a name="800"></a>/*
<a name="801"></a> *   Command interruption signal macros.  
<a name="802"></a> */
<a name="803"></a>
<a name="804"></a>/* a concise macro to throw an ExitSignal */
<a name="805"></a>#define exit throw new ExitSignal()
<a name="806"></a>
<a name="807"></a>/* a concise macro to throw an ExitActionSignal */
<a name="808"></a>#define exitAction throw new ExitActionSignal()
<a name="809"></a>
<a name="810"></a>/* a concise macro to throw an AbortImplicitSignal */
<a name="811"></a>#define abortImplicit throw new AbortImplicitSignal()
<a name="812"></a>
<a name="813"></a>/* a concise macro to throw an Abort signal */
<a name="814"></a>#define abort throw new AbortActionSignal()
<a name="815"></a>
<a name="816"></a>/* a concise macro to throw a Skip signal */
<a name="817"></a>#define skip throw new SkipSignal() 
<a name="818"></a>
<a name="819"></a>/* ------------------------------------------------------------------------ */
<a name="820"></a>/*
<a name="821"></a> *   aHref() flags 
<a name="822"></a> */
<a name="823"></a>#define AHREF_Plain  0x0001    /* plain text hyperlink (no underline/color) */
<a name="824"></a>
<a name="825"></a>
<a name="826"></a>
<a name="827"></a>/* ------------------------------------------------------------------------ */
<a name="828"></a>/*
<a name="829"></a> *   An achievement defines its descriptive text.  It can also optionally
<a name="830"></a> *   define the number of points it awards.  
<a name="831"></a> */
<a name="832"></a>Achievement template +points? "desc";
<a name="833"></a>
<a name="834"></a>
<a name="835"></a>
<a name="836"></a>/* ------------------------------------------------------------------------ */
<a name="837"></a>/*
<a name="838"></a> *   Templates for style tags 
<a name="839"></a> */
<a name="840"></a>StyleTag template 'tagName' 'openText'? 'closeText'?;
<a name="841"></a>
<a name="842"></a>/* ------------------------------------------------------------------------ */
<a name="843"></a>/*
<a name="844"></a> *   Object definition templates 
<a name="845"></a> */
<a name="846"></a>
<a name="847"></a>Thing template 'vocab' @location? "desc"?;
<a name="848"></a>Topic template 'vocab' @familiar?;
<a name="849"></a>
<a name="850"></a>Room template 'roomTitle' 'vocab' "desc"?;
<a name="851"></a>Room template 'roomTitle' "desc"?;
<a name="852"></a>
<a name="853"></a>Region template [rooms];
<a name="854"></a>
<a name="855"></a>Door template  'vocab' @location? "desc"? -&gt;otherSide;
<a name="856"></a>Door template  -&gt;otherSide 'vocab' @location? "desc"?;
<a name="857"></a>Door template  'vocab' @location? -&gt;otherSide "desc"?;
<a name="858"></a>Door template  'vocab' -&gt;otherSide @location? "desc"?;
<a name="859"></a>
<a name="860"></a>
<a name="861"></a>TravelConnector template 'vocab'? @location? "desc"? -&gt;destination;
<a name="862"></a>TravelConnector template -&gt;destination "travelDesc";
<a name="863"></a>
<a name="864"></a>Enterable template inherited -&gt;connector;
<a name="865"></a>Enterable template -&gt;connector inherited;
<a name="866"></a>
<a name="867"></a>Unthing template 'vocab' @location? 'notHereMsg'?;
<a name="868"></a>Unthing template @unObject @location? 'notHereMsg'?;
<a name="869"></a>
<a name="870"></a>SensoryEmanation template inherited [eventList]?;
<a name="871"></a>
<a name="872"></a>ActorState template @location? "specialDesc" 'stateDesc' | "stateDesc" ? ;
<a name="873"></a>ActorState template @location;
<a name="874"></a>
<a name="875"></a>TopicGroup template @location? +scoreBoost? 'convKeys' | [convKeys] ? ;
<a name="876"></a>
<a name="877"></a>
<a name="878"></a>TopicEntry template
<a name="879"></a>   -&gt;location? 
<a name="880"></a>   +matchScore?
<a name="881"></a>   @matchObj | [matchObj] | 'matchPattern'
<a name="882"></a>   "topicResponse" | [eventList] ?;
<a name="883"></a>
<a name="884"></a>/* a ShuffledEventList version of the above */
<a name="885"></a>TopicEntry template
<a name="886"></a>    -&gt;location?
<a name="887"></a>   +matchScore?
<a name="888"></a>   @matchObj | [matchObj] | 'matchPattern'
<a name="889"></a>   [firstEvents] [eventList];
<a name="890"></a>
<a name="891"></a>/* we can also include *both* the match object/list *and* pattern */
<a name="892"></a>TopicEntry template
<a name="893"></a>    -&gt;location?
<a name="894"></a>   +matchScore?
<a name="895"></a>   @matchObj | [matchObj]
<a name="896"></a>   'matchPattern'
<a name="897"></a>   "topicResponse" | [eventList] ?;
<a name="898"></a>
<a name="899"></a>/* a ShuffledEventList version of the above */
<a name="900"></a>TopicEntry template
<a name="901"></a>   -&gt;location? 
<a name="902"></a>   +matchScore?
<a name="903"></a>   @matchObj | [matchObj]
<a name="904"></a>   'matchPattern'
<a name="905"></a>   [firstEvents] [eventList]; 
<a name="906"></a>
<a name="907"></a>/* Version of ActorTopicEntry template for use with Facts and kTag */
<a name="908"></a>ActorTopicEntry template -&gt;location? +matchScore? "topicResponse" | [eventList];
<a name="909"></a>
<a name="910"></a>QueryTopic template
<a name="911"></a>   -&gt;location? 
<a name="912"></a>   +matchScore? 'matchPattern'
<a name="913"></a>    "topicResponse" | [eventList] ?;
<a name="914"></a>
<a name="915"></a>QueryTopic template
<a name="916"></a>    -&gt;location?
<a name="917"></a>    +matchScore? 'matchPattern'
<a name="918"></a>    [firstEvents] [eventList];    
<a name="919"></a>
<a name="920"></a>QueryTopic template
<a name="921"></a>    -&gt;location?
<a name="922"></a>   +matchScore? 'qtype'
<a name="923"></a>   @matchObj | [matchObj] | 'matchPattern'
<a name="924"></a>   "topicResponse" | [eventList] ?;
<a name="925"></a>
<a name="926"></a>/* a ShuffledEventList version of the above */
<a name="927"></a>QueryTopic template
<a name="928"></a>    -&gt;location?
<a name="929"></a>   +matchScore? 'qtype'
<a name="930"></a>   @matchObj | [matchObj] | 'matchPattern'
<a name="931"></a>   [firstEvents] [eventList];
<a name="932"></a>
<a name="933"></a>/* we can also include *both* the match object/list *and* pattern */
<a name="934"></a>QueryTopic template
<a name="935"></a>    -&gt;location?
<a name="936"></a>   +matchScore? 'qtype'
<a name="937"></a>   @matchObj | [matchObj]
<a name="938"></a>   'matchPattern'
<a name="939"></a>   "topicResponse" | [eventList] ?;
<a name="940"></a>
<a name="941"></a>/* a ShuffledEventList version of the above */
<a name="942"></a>QueryTopic template
<a name="943"></a>    -&gt;location?
<a name="944"></a>   +matchScore? 'qtype'
<a name="945"></a>   @matchObj | [matchObj]
<a name="946"></a>   'matchPattern'
<a name="947"></a>   [firstEvents] [eventList];
<a name="948"></a>
<a name="949"></a>SayTopic template
<a name="950"></a>    -&gt;location?
<a name="951"></a>    +matchScore?
<a name="952"></a>    'tTag' 'extraVocab'
<a name="953"></a>    "topicResponse" | [eventList] ?;
<a name="954"></a>
<a name="955"></a>CommandTopic template -&gt;location? +matchScore? 
<a name="956"></a>    
<a name="957"></a>    @matchObj | [matchObj]
<a name="958"></a>    @matchDobj @matchIobj? "topicResponse" | [eventList]? ;
<a name="959"></a>
<a name="960"></a>CommandTopic template -&gt;location? +matchScore?     
<a name="961"></a>    @matchObj | [matchObj] [matchDobj] @matchIobj "topicResponse" | [eventList]? ;
<a name="962"></a>
<a name="963"></a>DefaultTopic template -&gt;location? "topicResponse" | [eventList];
<a name="964"></a>DefaultConsultTopic template -&gt;location? "topicResponse" | [eventList];
<a name="965"></a>DefaultThought template -&gt;location? "topicResponse" | [eventList];
<a name="966"></a>
<a name="967"></a>/* miscellanous topics just specify the response text or list */
<a name="968"></a>MiscTopic template -&gt;location? "topicResponse" | [eventList];
<a name="969"></a>MiscTopic template -&gt;location? [firstEvents] [eventList];
<a name="970"></a>NodeContinuationTopic template -&gt;location? "topicResponse" | [eventList];
<a name="971"></a>NodeContinuationTopic template -&gt;location? [firstEvents] [eventList];
<a name="972"></a>
<a name="973"></a>/* AltTopics just specify the response text or list */
<a name="974"></a>AltTopic template -&gt;location? "topicResponse" | [eventList];
<a name="975"></a>AltTopic template -&gt;location? [firstEvents] [eventList];
<a name="976"></a>
<a name="977"></a>
<a name="978"></a>AgendaItem template @location;
<a name="979"></a>
<a name="980"></a>/* The ProxyActor template just specifies the location (i.e. the base Actor) */
<a name="981"></a>ProxyActor template @location;
<a name="982"></a>
<a name="983"></a>/* ProxyRoom templates - the only compulsory element is the destination. */
<a name="984"></a>ProxyRoom template 'vocab'? "desc"? -&gt;destination;
<a name="985"></a>ProxyRoom template 'vocab'? -&gt;destination "desc"?; 
<a name="986"></a>
<a name="987"></a>Doer template 'cmd';
<a name="988"></a>RemapCmd template 'cmd' @where? 'remappedCmd'?;
<a name="989"></a>
<a name="990"></a>/* Templates for use with test sequences */
<a name="991"></a>Test template 'testName' [testList] @location? [testHolding]?;
<a name="992"></a>Test template 'testName' [testList] [testHolding]? @location?;
<a name="993"></a>
<a name="994"></a>/* Define some convenient abbreviations for ConvNode related objects */
<a name="995"></a>#define NEC NodeEndCheck
<a name="996"></a>#define NCT NodeContinuationTopic
<a name="997"></a>#define DCT DefaultConvstayTopic
<a name="998"></a>
<a name="999"></a>
<a name="1000"></a>/* Define convenient named constants for use with ConvAgendaItem */
<a name="1001"></a>#define InitiateConversationReason 1
<a name="1002"></a>#define ConversationLullReason 2
<a name="1003"></a>#define DefaultTopicReason 3
<a name="1004"></a>
<a name="1005"></a>
<a name="1006"></a>
<a name="1007"></a>/* ------------------------------------------------------------------------ */
<a name="1008"></a>/*
<a name="1009"></a> *   Command interruption signal macros.  
<a name="1010"></a> */
<a name="1011"></a>
<a name="1012"></a>/*
<a name="1013"></a> *   Terminate execution of the command line.  This aborts the current
<a name="1014"></a> *   command, including any remaining object iterations for the current
<a name="1015"></a> *   action, and discards anything else on the command line.  
<a name="1016"></a> */
<a name="1017"></a>#define exitCommandLine  throw new ExitCommandLineSignal()
<a name="1018"></a>/*----------------------------------------------------------------------------*/
<a name="1019"></a>/*
<a name="1020"></a> *   enums for different types of lock:
<a name="1021"></a> */    
<a name="1022"></a>   
<a name="1023"></a>enum notLockable, lockableWithoutKey, lockableWithKey, indirectLockable;
<a name="1024"></a>
<a name="1025"></a>enum masculine, feminine, neuter;
<a name="1026"></a>
<a name="1027"></a>/* ------------------------------------------------------------------------ */
<a name="1028"></a>/*
<a name="1029"></a> *   The current library messages object.  This is the source object for
<a name="1030"></a> *   messages that don't logically relate to the actor carrying out the
<a name="1031"></a> *   comamand.  It's mostly used for meta-command replies, and for text
<a name="1032"></a> *   fragments that are used to construct descriptions.
<a name="1033"></a> *   
<a name="1034"></a> *   This message object isn't generally used for parser messages or action
<a name="1035"></a> *   replies - most of those come from the objects given by the current
<a name="1036"></a> *   actor's getParserMessageObj() or getActionMessageObj(), respectively.
<a name="1037"></a> *   
<a name="1038"></a> *   By default, this is set to libMessages.  The library never changes this
<a name="1039"></a> *   itself, but a game can change this if it wants to switch to a new set of
<a name="1040"></a> *   messages during a game.  (If you don't need to change messages during a
<a name="1041"></a> *   game, but simply want to customize some of the default messages, you
<a name="1042"></a> *   don't need to set this variable - you can simply use 'modify
<a name="1043"></a> *   libMessages' instead.  This variable is designed for cases where you
<a name="1044"></a> *   want to *dynamically* change the standard messages during the game.)  
<a name="1045"></a> */
<a name="1046"></a>#define gLibMessages (libGlobal.libMessageObj)
<a name="1047"></a>
<a name="1048"></a>/* 
<a name="1049"></a> *   the exit lister object - if the exits module isn't included in the
<a name="1050"></a> *   game, this will be nil 
<a name="1051"></a> */
<a name="1052"></a>#define gExitLister (libGlobal.exitListerObj)
<a name="1053"></a>
<a name="1054"></a>/*
<a name="1055"></a> *   the hint manager object - if the hints module isn't included in the
<a name="1056"></a> *   game, this will be nil 
<a name="1057"></a> */
<a name="1058"></a>#define gHintManager (libGlobal.hintManagerObj)
<a name="1059"></a>
<a name="1060"></a>
<a name="1061"></a>/*
<a name="1062"></a> *   the extra hint manager object - if the hints module isn't included in the
<a name="1063"></a> *   game, this will be nil 
<a name="1064"></a> */
<a name="1065"></a>#define gExtraHintManager (libGlobal.extraHintManagerObj)
<a name="1066"></a>
<a name="1067"></a>
<a name="1068"></a>/* ------------------------------------------------------------------------ */
<a name="1069"></a>/*
<a name="1070"></a> *   Convenience macros for controlling the narrative tense.
<a name="1071"></a> */
<a name="1072"></a>
<a name="1073"></a>/*
<a name="1074"></a> *   Set the current narrative tense.  Use val = true for past and
<a name="1075"></a> *   val = nil for present.
<a name="1076"></a> */
<a name="1077"></a>#define setPastTense(val) (gameMain.usePastTense = (val))
<a name="1078"></a>
<a name="1079"></a>/*
<a name="1080"></a> *   Shorthand macro for selecting one of two values depending on the
<a name="1081"></a> *   current narrative tense.
<a name="1082"></a> */
<a name="1083"></a>#define tSel(presVal, pastVal) \
<a name="1084"></a>    (gameMain.usePastTense ? (pastVal) : (presVal))
<a name="1085"></a>
<a name="1086"></a>/*
<a name="1087"></a> *   Temporarily override the current narrative tense and invoke a callback
<a name="1088"></a> *   function.
<a name="1089"></a> */
<a name="1090"></a>#define withPresent(callback) (withTense(nil, (callback)))
<a name="1091"></a>#define withPast(callback)    (withTense(true, (callback)))
<a name="1092"></a>
<a name="1093"></a>
<a name="1094"></a>/* ------------------------------------------------------------------------ */
<a name="1095"></a>/*
<a name="1096"></a> *   Object role identifiers.  These are used to identify the role of a noun
<a name="1097"></a> *   phrase in a command.
<a name="1098"></a> *   
<a name="1099"></a> *  
<a name="1100"></a> */
<a name="1101"></a>
<a name="1102"></a>
<a name="1103"></a>/*
<a name="1104"></a> *   A special role for the "other" object of a two-object command.  This
<a name="1105"></a> *   can be used in certain contexts (such as remapTo) where a particular
<a name="1106"></a> *   object role is implied by the context, and where the action involved
<a name="1107"></a> *   has exactly two objects; OtherObject in such contexts means
<a name="1108"></a> *   DirectObject when the implied role is IndirectObject, and vice versa. 
<a name="1109"></a> */
<a name="1110"></a>enum OtherObject;
<a name="1111"></a>
<a name="1112"></a>
<a name="1113"></a>/* ------------------------------------------------------------------------ */
<a name="1114"></a>/* 
<a name="1115"></a> *   A couple of utility macros we use internally for turning macro values
<a name="1116"></a> *   into strings.  STRINGIZE(x) expands any macros in its argument and then
<a name="1117"></a> *   turns the result into a single-quoted string, which can then be used in
<a name="1118"></a> *   regular program text or in directives that evaluate constant
<a name="1119"></a> *   expressions, such as #if.  (STRINGIZE is the real macro; _STRINGIZE is
<a name="1120"></a> *   needed to force expansion of any macros in the argument, which is
<a name="1121"></a> *   required because of the weird ANSI C expansion-order rules, and which
<a name="1122"></a> *   works because of same.)  
<a name="1123"></a> */
<a name="1124"></a>#define _STRINGIZE(x) #@x
<a name="1125"></a>#define STRINGIZE(x)  _STRINGIZE(x)
<a name="1126"></a>
<a name="1127"></a>
<a name="1128"></a>/* ------------------------------------------------------------------------ */
<a name="1129"></a>/*
<a name="1130"></a> *   Msg() - define a custom message to override a library message.  'id' is
<a name="1131"></a> *   the message ID, which is the same ID used for the DMsg() message that
<a name="1132"></a> *   you wish to override.  Do NOT use quotes around the ID - just enter it
<a name="1133"></a> *   as though it were a variable name.  'txt' is the message text, as a
<a name="1134"></a> *   single-quoted string.  
<a name="1135"></a> *   
<a name="1136"></a> *   This is used in CustomMessages objects to define message overrides.  See
<a name="1137"></a> *   CustomMessages for full details.  
<a name="1138"></a> */
<a name="1139"></a>#define Msg(id, txt)  #@id, txt
<a name="1140"></a>
<a name="1141"></a>/* Template for CustomMessages objects */
<a name="1142"></a>CustomMessages template [messages] +priority?;
<a name="1143"></a>
<a name="1144"></a>
<a name="1145"></a>
<a name="1146"></a>/* ------------------------------------------------------------------------ */
<a name="1147"></a>/*
<a name="1148"></a> *   DMsg() - default English library message cover macro.
<a name="1149"></a> *   
<a name="1150"></a> *   Whenever the library displays a message, it uses the DMsg() macro.  The
<a name="1151"></a> *   arguments are a message ID, and the default English message text to
<a name="1152"></a> *   display.  The message ID is a string that identifies the message; this
<a name="1153"></a> *   is used to look for overriding customizations of the message.  Refer to
<a name="1154"></a> *   the CustomMessages class for information on customizing the standard
<a name="1155"></a> *   library messages.
<a name="1156"></a> *   
<a name="1157"></a> *   In our approach, the library defines the default English text of the
<a name="1158"></a> *   messages in-line, directly in the code.  On the surface, this is
<a name="1159"></a> *   contrary to standard practices in most modern programming projects,
<a name="1160"></a> *   which strive to make translations easier by separating the message text
<a name="1161"></a> *   from the program code, gathering all of the text into a central message
<a name="1162"></a> *   file that can be replaced for each language.  Despite appearances, we're
<a name="1163"></a> *   accomplishing the same thing - but in our system, we have the advantage
<a name="1164"></a> *   that we *also* define the default English message text in-line as part
<a name="1165"></a> *   of the code it applies to.  This makes it easier to read the code by
<a name="1166"></a> *   keeping a message and its full context in one place; this way you don't
<a name="1167"></a> *   have to shuttle between the code and message file.
<a name="1168"></a> *   
<a name="1169"></a> *   Here's how we accomplish the message separation required for
<a name="1170"></a> *   translations, and also for games that wish to customize the library
<a name="1171"></a> *   defaults.  The DMsg() macro requires both the default English message
<a name="1172"></a> *   text *and* an ID key for the message.  The message display function
<a name="1173"></a> *   receives both.  The display function proceeds to look up the ID key in a
<a name="1174"></a> *   translation table; if it finds an entry, it uses the version of the
<a name="1175"></a> *   message in the translation table instead of the English default passed
<a name="1176"></a> *   in via DMsg().  A language module can provide a message table that
<a name="1177"></a> *   defines the language translations, and a game can provide a table that
<a name="1178"></a> *   further customizes the library messages to fit its narrative style.
<a name="1179"></a> *   
<a name="1180"></a> *   There's one additional element.  Translators and game authors need to be
<a name="1181"></a> *   able to see all of the messages in one place, so they can create their
<a name="1182"></a> *   tables.  We would seem to lack that central list of English messages.
<a name="1183"></a> *   Fortunately, by using a standard macro for each message, we can extract
<a name="1184"></a> *   a comprehensive English message list automatically via a special tool.
<a name="1185"></a> *   We use this as part of the library release process to create the English
<a name="1186"></a> *   message file for reference.
<a name="1187"></a> *   
<a name="1188"></a> *   Note that the macro expansion includes the default English text only in
<a name="1189"></a> *   English builds.  It omits the text in non-English builds.  This is to
<a name="1190"></a> *   save space - we assume that the English messages will all be overridden
<a name="1191"></a> *   anyway by each translated library version, so there's no point in
<a name="1192"></a> *   including their text in the final compiled program.  
<a name="1193"></a> */
<a name="1194"></a>#if STRINGIZE(LANGUAGE) == 'english'
<a name="1195"></a>#define DMsg(id, txt, args...)  message(#@id, txt, ##args)
<a name="1196"></a>#define BMsg(id, txt, args...)  buildMessage(#@id, txt, ##args)
<a name="1197"></a>#else
<a name="1198"></a>#define DMsg(id, txt, args...)  message(#@id, nil, ##args)
<a name="1199"></a>#define BMsg(id, txt, args...)  buildMessage(#@id, nil, ##args)
<a name="1200"></a>#endif
<a name="1201"></a>
<a name="1202"></a>/* ------------------------------------------------------------------------ */
<a name="1203"></a>/*
<a name="1204"></a> *   Debugging.  When we compile in development mode, we'll include a number
<a name="1205"></a> *   of functions and methods that display information for debugging
<a name="1206"></a> *   purposes.  We omit these in release builds to keep the compiled file
<a name="1207"></a> *   size smaller, and to avoid making it too easy for end users to
<a name="1208"></a> *   snoop around in the program internals.
<a name="1209"></a> */
<a name="1210"></a>#ifdef __DEBUG
<a name="1211"></a># define IfDebug(key, code) \
<a name="1212"></a>    if (DebugCtl.enabled[#@key]) { code; } else { }
<a name="1213"></a>#else
<a name="1214"></a># define IfDebug(key, code)
<a name="1215"></a>#endif
<a name="1216"></a>
<a name="1217"></a>#define gOutStream (outputManager.curOutputStream)
<a name="1218"></a>
<a name="1219"></a>#ifdef __DEBUG
<a name="1220"></a>#include &lt;dynfunc.h&gt;
<a name="1221"></a>#endif
<a name="1222"></a>
<a name="1223"></a>/*
<a name="1224"></a> *   Some message processors add their own special parameters to messages,
<a name="1225"></a> *   because they want to use expansion parameters (in the "{the dobj/him}"
<a name="1226"></a> *   format) outside of the set of objects directly involved in the command.
<a name="1227"></a> *   
<a name="1228"></a> *   The Action method setMessageParam() lets you define such a parameter,
<a name="1229"></a> *   but for convenience, we define this macro for setting one or more
<a name="1230"></a> *   parameters whose names exactly match their local variable names.  In
<a name="1231"></a> *   other words, if you call this macro like this:
<a name="1232"></a> *   
<a name="1233"></a> *   gMessageParams(obj, cont)
<a name="1234"></a> *   
<a name="1235"></a> *   then you'll get one parameter with the text name 'obj' whose expansion
<a name="1236"></a> *   will be the value of the local variable obj, and another with text name
<a name="1237"></a> *   'cont' whose expansion is the value of the local variable cont.  
<a name="1238"></a> */
<a name="1239"></a>#define gMessageParams(var...) \
<a name="1240"></a>    (gAction.setMessageParams(var#foreach/#@var, var/,/))
<a name="1241"></a>
<a name="1242"></a>/* ------------------------------------------------------------------------ */
<a name="1243"></a>/*
<a name="1244"></a> *   Definitions for the menu system
<a name="1245"></a> */
<a name="1246"></a>
<a name="1247"></a>/* 
<a name="1248"></a> *   The indices for the key values used to navigate menus, which are held
<a name="1249"></a> *   in the keyList array of MenuItems.  
<a name="1250"></a> */
<a name="1251"></a>#define M_QUIT      1
<a name="1252"></a>#define M_PREV      2
<a name="1253"></a>#define M_UP        3
<a name="1254"></a>#define M_DOWN      4
<a name="1255"></a>#define M_SEL       5
<a name="1256"></a>
<a name="1257"></a>/* some templates for defining menu items */
<a name="1258"></a>MenuItem template 'title' 'heading'?;
<a name="1259"></a>MenuTopicItem template 'title' 'heading'? [menuContents];
<a name="1260"></a>MenuLongTopicItem template 'title' 'heading'? 'menuContents' | "menuContents";
<a name="1261"></a>
<a name="1262"></a>/* templates for hint system objects */
<a name="1263"></a>Goal template -&gt;closeWhenAchieved? 'title' 'heading'? [menuContents];
<a name="1264"></a>Hint template 'hintText' [referencedGoals]?;
<a name="1265"></a>
<a name="1266"></a>/* 
<a name="1267"></a> *   A Template to facilitate the definition of ExtraHints. We can define it 
<a name="1268"></a> *   here and not in a header file since ExtraHints are only defined in this 
<a name="1269"></a> *   source file. */
<a name="1270"></a>
<a name="1271"></a>ExtraHint template +hintDelay? "hintText" | [eventList];
<a name="1272"></a>
<a name="1273"></a>Tip template "desc" | 'desc';
<a name="1274"></a>    
<a name="1275"></a>/* templates for EventLists */
<a name="1276"></a>
<a name="1277"></a>EventList template [eventList];
<a name="1278"></a>ShuffledEventList template [firstEvents] [eventList];
<a name="1279"></a>
<a name="1280"></a>/* template for Scenery Class */
<a name="1281"></a>Scenery template @location? [scenList];
<a name="1282"></a>
<a name="1283"></a>/* template and macros for Facts module */
<a name="1284"></a>Fact template 'name' [topics]? 'desc' [initiallyKnownBy]?;
<a name="1285"></a>
<a name="1286"></a>#define gFact(tag) (factManager.getFact(tag))
<a name="1287"></a>#define gFactDesc(tag) (factManager.getFactDesc(tag))
<a name="1288"></a>
<a name="1289"></a>/* Convenient synonyms for two ActorTopicEntry properties used in conjunction with Facts. */
<a name="1290"></a>#define rTag aTag
<a name="1291"></a>#define iTag tTag
<a name="1292"></a>
<a name="1293"></a>
<a name="1294"></a>/* ------------------------------------------------------------------------ */
<a name="1295"></a>/*  
<a name="1296"></a> *   Property synonyms
<a name="1297"></a> */
<a name="1298"></a>
<a name="1299"></a>/* 
<a name="1300"></a> *   The library uses isEdible rather than isEatable, since edible is the more
<a name="1301"></a> *   natural word to use, but strict consistency might have dictated isEatable,
<a name="1302"></a> *   so we make it an effective synonym in case some game authors use it.
<a name="1303"></a> */
<a name="1304"></a>#define isEatable isEdible
<a name="1305"></a>
<a name="1306"></a>/* Further macros for various isXable properties game author may spell wrong. */
<a name="1307"></a>#define isCutable isCuttable
<a name="1308"></a>#define isTouchable isFeelable
<a name="1309"></a>#define isDropable isDroppable
<a name="1310"></a>#define isLookUnderable canLookUnderMe
<a name="1311"></a>#define isLooBehindable canLookBehindMe
<a name="1312"></a>
<a name="1313"></a>#define isLookThroughable canLookThroughMe
<a name="1314"></a>#define isLookThrughable canLookThroughMe
<a name="1315"></a>#define isGoThroughable canGoThroughMe
<a name="1316"></a>#define isGoThruable canGoThroughMe
<a name="1317"></a>#define isGoAlongable canGoAlongMe
<a name="1318"></a>
<a name="1319"></a>#define isSwitchOnable isSwitchable
<a name="1320"></a>#define canSwitchMeOn isSwitchable
<a name="1321"></a>#define canSwichOnMe isSwitchable
<a name="1322"></a>#define isSwitchOffable isSwitchable
<a name="1323"></a>#define canSwitchMeOff isSwitchable
<a name="1324"></a>#define canSwichOffMe isSwitchable
<a name="1325"></a>#define isFlipable isFlippable
<a name="1326"></a>#define isClimbUpable canClimbUpMe
<a name="1327"></a>#define isClimbDownable canClimbDownMe
<a name="1328"></a>#define isStandOnable canStandOnMe
<a name="1329"></a>#define isSitOnable canSitOnMe
<a name="1330"></a>#define isLieOnable canLieOnMe
<a name="1331"></a>#define isDigable isDiggable
<a name="1332"></a>#define isTurnToable canTurnToMe
<a name="1333"></a>#define isSetToable canSetToMe
<a name="1334"></a>#define isPluggable isPlugable
<a name="1335"></a>#define isUnpluggable isUnplugable
<a name="1336"></a>#define isJumpOffable canJumpOffMe
<a name="1337"></a>#define isJumpOverable camJumpOverMe
<a name="1338"></a>#define isSetable isSettable
<a name="1339"></a>#define isTypeOnable canTypeOnMe
<a name="1340"></a>#define isEnterOnable canEnterOnMe
<a name="1341"></a>#define isWriteOnAble canWriteOnMe
<a name="1342"></a>#define isPushTravelable canPushTravel
<a name="1343"></a>
<a name="1344"></a>
<a name="1345"></a>
<a name="1346"></a>/*  
<a name="1347"></a> *   Conversely, authors alive to the Latin root of edible might try the
<a name="1348"></a> *   latinate isPotable instead of isDrinkable.
<a name="1349"></a> */
<a name="1350"></a>#define isPotable isDrinkable
<a name="1351"></a>
<a name="1352"></a>/* ------------------------------------------------------------------------ */
<a name="1353"></a>/*
<a name="1354"></a> *   String templates for room descriptions etc.
<a name="1355"></a> */
<a name="1356"></a>
<a name="1357"></a>string template &lt;&lt;mention name * &gt;&gt; mentionObj;
<a name="1358"></a>string template &lt;&lt;mention a * &gt;&gt; mentionA;
<a name="1359"></a>string template &lt;&lt;mention an * &gt;&gt; mentionA;
<a name="1360"></a>string template &lt;&lt;mention the * &gt;&gt; mentionThe;
<a name="1361"></a>string template &lt;&lt; list of * is &gt;&gt; listStrIs;
<a name="1362"></a>string template &lt;&lt; list of * &gt;&gt; makeListInStr;
<a name="1363"></a>string template &lt;&lt; the list of * &gt;&gt; makeTheListStr;
<a name="1364"></a>string template &lt;&lt; is list of * &gt;&gt; isListStr;
<a name="1365"></a>string template &lt;&lt; exclude * &gt;&gt; makeMentioned;
<a name="1366"></a>
<a name="1367"></a>/* ------------------------------------------------------------------------*/
<a name="1368"></a>/*
<a name="1369"></a> *   Some useful macros for command text.
<a name="1370"></a> */
<a name="1371"></a>
<a name="1372"></a>/* Get the first word the player entered for the current command. */
<a name="1373"></a>#define gVerbWord (gCommand == nil || gCommand.verbProd == nil ? '' \
<a name="1374"></a>    : getTokVal(gCommand.verbProd.tokenList[1]))
<a name="1375"></a>
<a name="1376"></a>/* Get the command tokens for the current command. */
<a name="1377"></a>#define gCommandToks (gCommand == nil || gCommand.verbProd == nil ? [] \
<a name="1378"></a>    : gCommand.verbProd.tokenList.mapAll({t: getTokVal(t)}))
<a name="1379"></a>
<a name="1380"></a>/* Test for the presence of tok among the command tokens entered by the player. */
<a name="1381"></a>#define gToksInclude(tok) gCommandToks.indexOf(tok)
<a name="1382"></a>
<a name="1383"></a>/* Get the command phrase for the current command. */
<a name="1384"></a>#define gVerbPhrase (gCommand.getCommandPhrase())
<a name="1385"></a>
<a name="1386"></a>/* ------------------------------------------------------------------------ */
<a name="1387"></a>/*
<a name="1388"></a> *   Size classes.  An object is large, medium, or small with respect to
<a name="1389"></a> *   each sense; the size is used to determine how well the object can be
<a name="1390"></a> *   sensed at a distance or when obscured.
<a name="1391"></a> *   
<a name="1392"></a> *   What "size" means depends on the sense.  For sight, the size
<a name="1393"></a> *   indicates the visual size of the object.  For hearing, the size
<a name="1394"></a> *   indicates the loudness of the object.  
<a name="1395"></a> */
<a name="1396"></a>
<a name="1397"></a>/* 
<a name="1398"></a> *   Large - the object is large enough that its details can be sensed
<a name="1399"></a> *   from a distance or through an obscuring medium.
<a name="1400"></a> */
<a name="1401"></a>enum large;
<a name="1402"></a>
<a name="1403"></a>/* 
<a name="1404"></a> *   Medium - the object can be sensed at a distance or when obscured, but
<a name="1405"></a> *   not in any detail.  Most objects fall into this category.  Note that
<a name="1406"></a> *   things that are parts of large objects should normally be medium.  
<a name="1407"></a> */
<a name="1408"></a>enum medium;
<a name="1409"></a>
<a name="1410"></a>/*
<a name="1411"></a> *   Small - the object cannot be sensed at a distance at all.  This is
<a name="1412"></a> *   appropriate for detailed parts of medium-class objects.  
<a name="1413"></a> */
<a name="1414"></a>enum small;
<a name="1415"></a>
<a name="1416"></a>/*  Enums for Goals in the Hint system */
<a name="1417"></a>enum OpenGoal, ClosedGoal, UndiscoveredGoal;
<a name="1418"></a>
<a name="1419"></a>/* Enums for Footnotes */
<a name="1420"></a>enum FootnotesFull, FootnotesMedium, FootnotesOff;
<a name="1421"></a>
<a name="1422"></a>/* Template for Footnotes */
<a name="1423"></a>Footnote template "desc";
<a name="1424"></a>
<a name="1425"></a>/* Template for ClockEvent */
<a name="1426"></a>ClockEvent template [eventTime];
<a name="1427"></a>
<a name="1428"></a>/* String Templates for Objective Time module */
<a name="1429"></a>string template &lt;&lt;take * seconds&gt;&gt; takeTime;
<a name="1430"></a>string template &lt;&lt;take * second&gt;&gt; takeTime;
<a name="1431"></a>string template &lt;&lt;take * sec&gt;&gt; takeTime;
<a name="1432"></a>string template &lt;&lt;take * secs&gt;&gt; takeTime;
<a name="1433"></a>
<a name="1434"></a>string template &lt;&lt;add * seconds&gt;&gt; addTime;
<a name="1435"></a>string template &lt;&lt;add * second&gt;&gt; addTime;
<a name="1436"></a>string template &lt;&lt;add * sec&gt;&gt; addTime;
<a name="1437"></a>string template &lt;&lt;add * secs&gt;&gt; addTime;
<a name="1438"></a>
<a name="1439"></a>
<a name="1440"></a>/* ------------------------------------------------------------------------- */
<a name="1441"></a>/*
<a name="1442"></a> *   Communication Link Types
<a name="1443"></a> *
<a name="1444"></a> *   AudioLink means audio communication only is available VideoLink means both
<a name="1445"></a> *   audio and visual links are available.
<a name="1446"></a> */
<a name="1447"></a>#define AudioLink 1
<a name="1448"></a>#define VideoLink 2
<a name="1449"></a>
<a name="1450"></a>
<a name="1451"></a>/* ------------------------------------------------------------------------ */
<a name="1452"></a>/*
<a name="1453"></a> *   Conversation manager macros
<a name="1454"></a> */
<a name="1455"></a>
<a name="1456"></a>/* has a topic key been revealed through &lt;.reveal&gt;? */
<a name="1457"></a>#define gRevealed(key)  (libGlobal.getRevealed(key)) 
<a name="1458"></a>
<a name="1459"></a>/* reveal a topic key, as though through &lt;.reveal&gt; */
<a name="1460"></a>#define gReveal(key, args...) (libGlobal.setRevealed(key, ## args))
<a name="1461"></a>
<a name="1462"></a>/* remove a topic key, as though through &lt;.unreveal&gt; */
<a name="1463"></a>#define gUnreveal(key) (libGlobal.setUnrevealed(key))
<a name="1464"></a>
<a name="1465"></a>/* mark a Topic/Thing as known/seen by the player character */
<a name="1466"></a>#define gSetKnown(obj) (gPlayerChar.setKnowsAbout(obj))
<a name="1467"></a>#define gSetSeen(obj) (gPlayerChar.setHasSeen(obj))
<a name="1468"></a>
<a name="1469"></a>/* does the player character know about obj? */
<a name="1470"></a>#define gKnown(obj) (gPlayerChar.knowsAbout(obj))
<a name="1471"></a>#define pcKnows(obj) (gPlayerChar.knowsAbout(obj))
<a name="1472"></a>
<a name="1473"></a>/* has a topic key been revealed to an NPC through &lt;.inform&gt;? */
<a name="1474"></a>#define gInformed(key) (getActor.informedAbout(key))
<a name="1475"></a>
<a name="1476"></a>/* is the topic key or object known to the NPC we're in conversaation with? */
<a name="1477"></a>#define npcKnows(obj) (getActor.knowsAbout(obj))
<a name="1478"></a>
<a name="1479"></a>/* the last topic mentioned in the course of the current conversation */
<a name="1480"></a>#define gLastTopic (libGlobal.lastTopicMentioned)
<a name="1481"></a>
<a name="1482"></a>/* the last fact mentioned in the course of the current conversation */
<a name="1483"></a>#define gLastFact (libGlobal.lastFactMentioned)
<a name="1484"></a>
<a name="1485"></a>/* Associated knowledge enums */
<a name="1486"></a>
<a name="1487"></a>enum likely, dubious, unlikely, untrue;
<a name="1488"></a>
<a name="1489"></a>/* Macros to deal with knowledge enums and their associated objects */
<a name="1490"></a>
<a name="1491"></a>#define BV(x) (defined(beliefManager) ? beliefManager.bvTab[x] : x)
<a name="1492"></a>
<a name="1493"></a>#define RNF(name_, desc, args...) revealNewFact(name_, desc, ## args)
<a name="1494"></a>#define INF(name_, desc, args...) informNewFact(name_, desc, ## args)
<a name="1495"></a>
<a name="1496"></a>
<a name="1497"></a>/* ------------------------------------------------------------------------- */
<a name="1498"></a>/*
<a name="1499"></a> *   Define some synonyms for potentially confusing property names
<a name="1500"></a> */
<a name="1501"></a>
<a name="1502"></a>#define checkTouchMsg checkFeelMsg
<a name="1503"></a>#define feelResponseMsg touchResponseMsg
<a name="1504"></a>
<a name="1505"></a>#define cannotTouchMsg cannotFeelMsg
<a name="1506"></a>
<a name="1507"></a>#define checkHitMsg checkAttackMsg
<a name="1508"></a>#define hitResponseMsg attackResponseMsg
<a name="1509"></a>
<a name="1510"></a>/*--------------------------------------------------------------------------- */
<a name="1511"></a>/* 
<a name="1512"></a> *   Define some macros to give abbreviated synonyms to inputManager method
<a name="1513"></a> */
<a name="1514"></a>
<a name="1515"></a>#define more inputManager.pauseForMore()
<a name="1516"></a>#define input(x...) inputManager.getInputLine(x)
<a name="1517"></a>#define waitKey(x...) inputManager.getKey(x)
<a name="1518"></a>
<a name="1519"></a>/*----------------------------------------------------------------------------*/
<a name="1520"></a>/*
<a name="1521"></a> *   Definitions for the rules.t extension
<a name="1522"></a> */
<a name="1523"></a>
<a name="1524"></a>#define stop return stopValue;
<a name="1525"></a>
<a name="1526"></a>/* 
<a name="1527"></a> *   Null value to return from Rules that don't stop a RuleBook from continuing
<a name="1528"></a> *   to consider rules.
<a name="1529"></a> */
<a name="1530"></a>enum null;
<a name="1531"></a>
<a name="1532"></a>/* 
<a name="1533"></a> *   Convenient abbreviations for rules that want to allow their RuleBook to
<a name="1534"></a> *   continue processing more rules.
<a name="1535"></a> */
<a name="1536"></a>#define rnull return null
<a name="1537"></a>#define nextrule return (rulebook.contValue)
<a name="1538"></a>#define nostop return (rulebook.contValue)
<a name="1539"></a>
<a name="1540"></a>Rule template @location? &amp;action | [action]?;
<a name="1541"></a>Rule template @location? "follow";
<a name="1542"></a>
<a name="1543"></a>/*----------------------------------------------------------------------------*/
<a name="1544"></a>/*
<a name="1545"></a> *   Definitions for the relations.t extension
<a name="1546"></a> */
<a name="1547"></a>
<a name="1548"></a>enum oneToOne, oneToMany, manyToOne, manyToMany;
<a name="1549"></a>Relation template 'name' 'reverseName'? @relationType? +reciprocal?;
<a name="1550"></a>
<a name="1551"></a>enum normalRelation, reverseRelation;
<a name="1552"></a>
<a name="1553"></a>/*----------------------------------------------------------------------------*/
<a name="1554"></a>/*
<a name="1555"></a> *   Definitions for the Signals Extension
<a name="1556"></a> */
<a name="1557"></a>
<a name="1558"></a>#define DefSignal(sig, nam) sig##Signal: Signal \
<a name="1559"></a>    name = #@nam\
<a name="1560"></a>    handleProp = &amp;handle_##sig
<a name="1561"></a>/*----------------------------------------------------------------------------*/
<a name="1562"></a>/*
<a name="1563"></a> *   Definitions for the SymConn Extension
<a name="1564"></a> */
<a name="1565"></a>
<a name="1566"></a>SymConnector template -&gt;destination;
<a name="1567"></a>SymConnector template @room1 @room2;
<a name="1568"></a>
<a name="1569"></a>SymPassage template -&gt;destination 'vocab' "desc"?;
<a name="1570"></a>SymPassage template 'vocab' -&gt;destination "desc"?;
<a name="1571"></a>SymPassage template 'vocab' @room1 @room2 "desc"?;
<a name="1572"></a>SymPassage template 'vocab' [rooms] "desc"?;
<a name="1573"></a> 
<a name="1574"></a>string template &lt;&lt;* by room&gt;&gt; byRoomFunc;
<a name="1575"></a>
<a name="1576"></a>/* Equivalent template for DSCon objects in main linrary. */
<a name="1577"></a>DSCon template 'vocab' @room1 @room2 "desc"?;
<a name="1578"></a>
<a name="1579"></a>DSTravelConnector template @room1 @room2;
<a name="1580"></a>DSTravelConnector template -&gt;room1 -&gt;room2;
<a name="1581"></a>
<a name="1582"></a>/* Templates for Passage and Stairways */
<a name="1583"></a>Passage template -&gt;destination 'vocab' @location? "desc"?;
<a name="1584"></a>Passage template 'vocab' @location? -&gt;destination "desc"?;
<a name="1585"></a>Passage template 'vocab' @location? "desc"? -&gt;destination; 
<a name="1586"></a>
<a name="1587"></a>StairwayUp template -&gt;destination 'vocab' @location? "desc"?;
<a name="1588"></a>StairwayUp template 'vocab' @location?  -&gt;destination "desc"?;
<a name="1589"></a>StairwayUp template 'vocab' @location? "desc"? -&gt;destination;
<a name="1590"></a>
<a name="1591"></a>StairwayDown template -&gt;destination 'vocab'@location? "desc"?;
<a name="1592"></a>StairwayDown template 'vocab' @location? -&gt;destination "desc"?;
<a name="1593"></a>StairwayDown template 'vocab' @location? "desc"? -&gt;destination;
<a name="1594"></a>
<a name="1595"></a>/*----------------------------------------------------------------------------*/
<a name="1596"></a>/*
<a name="1597"></a> *   Definitions for the eventListItem Extension
<a name="1598"></a> */
<a name="1599"></a>EventListItem template @myListObj? ~isReady? +minInterval? *maxFireCt? "invokeItem"? ;
<a name="1600"></a>
<a name="1601"></a>/*-----------------------------------------------------------------------------*/
<a name="1602"></a>/*
<a name="1603"></a> *   Definitions for Moods and Stances
<a name="1604"></a> */
<a name="1605"></a>
<a name="1606"></a>/* Define a new Stance */
<a name="1607"></a>#define DefStance(name_, score_) \
<a name="1608"></a>    name_ ## Stance: Stance \
<a name="1609"></a>    name = #@name_ \
<a name="1610"></a>    score = score_
<a name="1611"></a>
<a name="1612"></a>/* Define a new Mood */
<a name="1613"></a>#define DefMood(name_) \
<a name="1614"></a>    name_ ## Mood: Mood \
<a name="1615"></a>    name = #@name_ 
<a name="1616"></a>
<a name="1617"></a>/* Is the actor whose agenda item, topic entry or whatever we're looking from in this stance? */
<a name="1618"></a>#define gStance (getActor().stance)
<a name="1619"></a>#define gStanceIs(st_) (getActor().stance == st_ ## Stance)
<a name="1620"></a>
<a name="1621"></a>/* What stance is this actor in? */
<a name="1622"></a>#define aStance(actor) (actor.stance)
<a name="1623"></a>
<a name="1624"></a>/* Is actor in this stance ? */
<a name="1625"></a>#define aStanceIs(actor, st_) (actor.stance == st_ ## Stance)
<a name="1626"></a>
<a name="1627"></a>/* Is actor in one of these stances? */
<a name="1628"></a>#define gStanceIn(st_...) \
<a name="1629"></a>    (gStance is in (st_#foreach: st_##Stance:, :))
<a name="1630"></a>
<a name="1631"></a>#define aStanceIn(actor, st_...) \
<a name="1632"></a>    (actor.stance is in (st_#foreach: st_##Stance:, ))
<a name="1633"></a>
<a name="1634"></a>/* What mood is getActor in? */
<a name="1635"></a>#define gMood (getActor().mood)
<a name="1636"></a>
<a name="1637"></a>/* Is getActor in one of these moods? */
<a name="1638"></a>#define gMoodIs(mood_) (getActor().mood == mood_ ## Mood)
<a name="1639"></a>
<a name="1640"></a>
<a name="1641"></a>/* What mood is actor in? */
<a name="1642"></a>#define aMood(actor) (actor.mood)
<a name="1643"></a>
<a name="1644"></a>/* Is actor in this mood? */
<a name="1645"></a>#define aMoodIs(actor, mood_) (actor.mood == mood_ ## Mood)
<a name="1646"></a>
<a name="1647"></a>/* Is getActor in one of these moods? */
<a name="1648"></a>#define gMoodIn(mood_...) \
<a name="1649"></a>    (gMood is in (mood_#foreach: mood_ ## Mood:, :))
<a name="1650"></a>
<a name="1651"></a>/* Is actor in one of these moods? */
<a name="1652"></a>#define aMoodIn(actor, mood_...) \
<a name="1653"></a>    (actor.mood is in (mood_#foreach: mood_##Mood:, :))
<a name="1654"></a>
<a name="1655"></a>/* Set stances towards the player character */
<a name="1656"></a>#define gSetStance(st_) (getActor.setStanceToward(gPlayerChar, st_ ## Stance))
<a name="1657"></a>#define aSetStance(actor, st_) (actor.setStanceToward(gPlayerChar, st_ ## Stance))
<a name="1658"></a>
<a name="1659"></a>/* Set moods */
<a name="1660"></a>#define gSetMood(mood_) (getActor.setMood(mood_ ## Mood))
<a name="1661"></a>#define aSetMood(actor, mood_) (actor.setMood(mood_ ## Mood))
<a name="1662"></a>
<a name="1663"></a>#define Sta(a, b, c) [a, b ## Stance, c]
<a name="1664"></a>
<a name="1665"></a>/* Templates for SpecialVerbs */
<a name="1666"></a>SpecialVerb template 'specVerb' 'stdVerb' @matchObjs | [matchObjs];
<a name="1667"></a>SpecialVerb template 'specVerb' @matchObjs | [matchObjs] 'stdVerb' ;
<a name="1668"></a>
<a name="1669"></a> /*----------------------------------------------------------------------------*/
<a name="1670"></a>/*
<a name="1671"></a> *   Include the header for the Date intrinsic class. For some reason the
<a name="1672"></a> *   compiler seems to prefer this to be at the end of this header file.
<a name="1673"></a> */
<a name="1674"></a>#include &lt;date.h&gt;
<a name="1675"></a>
<a name="1676"></a>#endif
</pre>
<div class=ftr>Adv3Lite Library Reference Manual<br>Generated on 08/12/2025 from adv3Lite version 2.2.2</div>
</body>
</html>
