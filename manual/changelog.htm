<html>
<!-- DERIVED FILE - DO NOT EDIT -->

<head>
<title>Final Moves &mdash; Change Log</title>
<link rel="stylesheet" href="sysman.css" type="text/css">
</head>
<body>
<div class="topbar"><img src="topbar.jpg" border=0></div>
<div class="nav">
<a class="nav" href="toc.htm">Table of Contents</a> | 
<a class="nav" href="final.htm">Change Log</a> &gt; 
Change Log
<br><span class="navnp"><a class="nav" href="conclusion.htm"><i>Prev:</i> Conclusion</a> &nbsp;&nbsp;&nbsp;  <a class="nav" href="manual_idx.html"><i>Next:</i> Index</a> &nbsp;&nbsp;&nbsp;</span>

</div>
<div class="main">
<h1>Change Log</h1>
<ul>
<li><a href="#v0.91">Version 0.91</a></li>
<li><a href="#v0.9">Version 0.9</a></li>
<li><a href="#v0.8">Version 0.8</a></li>
<li><a href="#v0.7">Version 0.7</a></li>
<li><a href="#v0.6">Version 0.6</a></li>
<li><a href="#v0.5">Version 0.5</a></li>
<li><a href="#v0.4">Version 0.4</a></li>
<li><a href="#v0.3">Version 0.3</a></li>
<li><a href="#v0.2">Version 0.2</a></li>
</ul>

<h2><a name="v0.91">Version 0.91</a></h2>

<p>The library now has a <strong>commLink</strong> object that can be used to establish remote communications between the player character and one or more other actors in remote locations. You can use <span class="code">commLink.connectTo(other)</span> to establish a remote audio link with other, or <span class="code">commLink.connectTo(other, true)</span> to establish a remote audiovisual link. Use <span class="code">commLink.disconnect()</span> to sever the connection again. For further details read about the <a href="query.htm#commlink">Communications Link Special</a> in the chapter on Querying the World Model.</p>
<hr>
<p>Bug fixed whereby an actor would never end a conversation through boredom (the boredomAgendaItem was never being added to Actors' agendaLists)</p>
<hr>
<br>

<h2><a name="v0.9">Version 0.9 (08 Jun 2013)</a></h2>
<p><strong>Slight risk of incompatibity:</strong> The <strong>mentionsAll()</strong> function has been withdrawn, since it's no longer needed, and it wasn't a good way of doing what in did anyway. Instead of testing <span class="code">mentionsAll(cmd)</span> test <span class="code">cmd.matchedAll</span>.</p>
<hr>
<p><strong>Slight risk of incompatibity:</strong> The regular verbs have been removed from the <span class="code">englishCustomVocab.verbParams</span> list, since they are no longer needed. If you have any code that still uses message parameters like <span class="code">{appears}</span> or <span class="code">{opens}</span> with regular verbs, you'll need to change them to the regular form (<span class="code">appear{s/ed}</span> or open<span class="code">{s/ed}</span>). Irregular verbs like <span class="code">{think}</span> or <span class="code">{take}</span> are not affected. </p>
<hr>
<p><strong>Very slight risk of incompatibity:</strong> In a few cases the withdrawal of regular verbs from the verbParams list might have caused problems with the <span class="code">{don't verb}</span> and <span class="code">{must verb}</span> parameter substitutions that required the past participle of <em>verb</em> in some tenses. To deal with this regular verbs in these constructions should now be followed by the appropriate past participle in square brackets; e.g. <span class="code">{don't open[ed]}</span> or <span class="code">{don't close[d]}</span> or <span class="code">{must stop[?ed]}</span>. This will only effect games in fairly unusual tenses, so it's quite likely that know existing game will actually be affected, although it has been necessary to change a few library messages to cater for this. Once again, irregular verbs (e.g. <span class="code">{must take}</span> or <span class="code">{don't know}</span>) are not affected.</p>
<hr>
<p><strong>Very slight risk of incompatibity:</strong> The properties <strong>showReport</strong> and <strong>giveReport</strong> have both been renamed to <strong>summaryReport</strong>, in the interests of consistency and ease of use. Since the use of these properties wasn't documented anywhere and they didn't quite work properly anyway, it's unlikely that any existing game code will be affected, but if any existing game code does make use of them it will need to rename them accordingly.</p>
<hr>
<p>It is now possible to summarize the results of a GIVE or SHOW command acting on a set of objects, rather than getting an individual report for each object. The newly-named <strong>summaryReport</strong> property is now correctly reset in the <span class="code">execGroup()</span> method of Give, Show, GiveImplicit and ShowImplicit and correctly used in the report phases of dobjFor(Give), dobjFor(Show), dobjFor(GiveImplicit) and dobjFor(ShowImplicit) on Thing. It is joined by a new property <strong>summaryProp</strong> defined and deployed in the same places. <span class="code">summaryProp</span> can be set to a property pointer to execute a method on the current interlocutor at the end of a GIVE or SHOW command executed on a set of objects. Instructions on how to use these properties can be found in the new section on <a href="actortopicentry.htm#summarizing">Summarizing Give and Show.</a>
<hr>
<p>A number of library messages that were found to be erroneous when making the foregoing changes have now been corrected.</p>
<hr>
<p>In previous versions the <strong>extraReport()</strong> macro did not carry out any message parameter substitutions. This may not be what all game code expects. extraReport() has accordingly be changed from a macro to a function, and unless the second, optional, parameter is specified as nil it will carry out message parameter substitutions before displaying its text.</p>
<hr>
<p>The message parameter substitutions <span class="code">{donot <em>verb</em>}</span> and (equivalently) <span class="code">{doesnot <em">verb</em>}</span> have been added. These work just like <span class="code">{dont <em>verb</em>}</span> and  <span class="code">{doesnt <em">verb</em>}</span>, except that the negation isn't contracted (e.g. "Fred does not respond" instead of "Fred doesn't respond").</p>
<hr>
<p>An <a href="instruct.htm">Instructions</a> module has been added to the English-specific part of the library. This allows games to provide a set of standard set of instructions for playing Interactive Fiction. It's based closely on the adv3 equivalent (from which it's largely taken), with one or two minor adaptations for adv3Lite. This is the first of several new features aimed at making adv3Lite more approachable to new players.</p>
<hr>
<p>A second feature aimed at new players is the optional module <a href="newbie.htm">newbie.t</a> in the English-specific part of the library. This looks out for various kinds of malformed commands that new players often attempt to use and provides more helpful responses than the standard parser error messages, in an attempt to nudge new players in the right direction. It also allows the game to watch out for when players seem to be getting stuck, particularly at the start of the game, so it can offer them some help.</p>
<hr>
<p>The third newbie-friendly feature that's been added is the <a href="hint.htm#extra">ExtraHint</a> mechanism, which allows game authors to display hints to players who look as if they may be getting stuck.</p>
<hr>
<p>The English part of the library now contains a <strong>yesOrNo()</strong> function which simply reads a command-line response and returns true for an affirmative response and nil otherwise. The Instructions module makes use of this, and it seemed worth adding it for general use.</p>
<hr>
<p>The SimpleAttachable class now has <strong>attachTo(obj)</strong> and <strong>detachFrom(obj)</strong> methods, which should make it easier and to attach and detach objects by programmatic fiat (e.g. when a magnet attracts a small item to itself).</p>
<hr>
<p>Thing now has a new <strong>hideFromAll(action)</strong> method, which can be used to exclude an object from the list of things the parser chooses in response to <em>ACTION</em> ALL.</p>
<hr>
<p>Thing now has a new <b>ownerNamed</b> property (in the English-specific part of the library). If this is true then the theName (but not the aName) property of this object will be followed by its name preceded by the possessive form of its owner's name, e.g. "Bob's wallet" or "Jane's mouth". This may be particularly useful in defining body parts, but is potentially useful in any situation where an object has a specific owner (do can in any case be referred to as "Bob's wallet" or "Jane's mouth" by the player) and we want to include the name of the owner when referring to the specific object in game output, e.g. "You take Bob's wallet" (it was lying on the table) but "Bob is carrying a wallet".</p>
<hr>
<p>The library now defines a new <strong>objUnlocked</strong> PreCondition. This isn't actually used anywhere in the library, but game code is free to use it. It would normally only be meaningful to do so in the dobjFor(Open) preCond list of objects with a lockability of either lockableWithoutKey or lockableWithKey. In the latter case the objUnlocked PreCondition will only attempt to unlock the object if the actor is carrying a key that might plausibly work.</p>
<hr>
<p>There is now an <a href="extra.htm#unthing">Unthing</a> class which can be used to represent objects that are absent.</p>
<hr>
<p>The Thing class now as an <strong>isHidden</strong> property which can be used to hide things from view. TravelConnector now accordingly defines <span class="code">isConnectorApparent = !isHidden</span>, so that a hidden TravelConnector (such as a concealed Door) is automatically not apparent.</p>
<hr>
<p>It's now possible to define weak tokens in a vocab string by placing them in parentheses. E.g. '(her) foot' would match 'her foot' or 'foot' but not 'her', or alternatively by following the word with the special token '[weak]', e.g. 'her[weak] foot'. These two methods are currently functionally equivalent to defining the vocab as 'her[prep] foot' but having a special syntax for weak tokens looks more intuitive and should allow for weak tokens and prepositions to be treated differently in the future should this turn out to be necessary.</p>
<hr>
<p>The VerbProduction class (and hence VerbRules) now has an isActive property, which can specify the conditions under which the VerbRule is matched (this makes it possible, for example, for the newbie.t module to switch off a whole lot of its VerbRules when a conversation is in progress so as not to intercept potentially valid conversational commands). An isActive property has also been added to the StringPreParser class, for similar reasons.</p>
<hr>
<p>The library defines two new macros <strong>gLocation</strong> and <strong>gRoom</strong> to get the player character's current location and current room respectively (often these will be the same, but they need not be if the player character's immediate location is something other than a Room, such as a bed or chair). It also defines a new trio of macros <strong>gTopic</strong>, <strong>gTopicText</strong> and <strong>gTopicMatch</strong>, which give the ResolvedTopic of any current TopicAction or TopicTAction, the text corresponding to that ResolvedTopic (i.e. the text it attempted to match) and the getBestMatch property of that ResolvedTopic (the Topic object it best matches).</p>
<hr>
<p>The library now attempts to be a bit smarter about combining implicit action reports, so that, for example:</p>
<p>(first taking the coin)<br>
(first taking the coin)<br>
(first taking the coin)</p>
<p>should become:</p>
<p>(first taking three coins)</p>
<hr>
<p>The Actor class now provided some default output in <strong>actorSpecialDesc</strong>. This is to ensure that NPCs are listed in room descriptions even if the game author doesn't define this property or a specialDesc.</p>
<hr>
<p>There has been some rearrangement of the verify methods of conversational commands. These are now all defined on Thing and not overridden on Actor. The new property <span class="code">canTalkToMe</span> is nil on Thing and true on Actor (and normally shouldn't be overridden by game code); this allows conversational commands on Actor but not Thing. The main purpose of this is to allow Actor to inherit the new verify tests on Thing preventing people talking to themselves (or giving or showing things to themselves).</p>
<hr>
<p>The new Thing property <strong>opened</strong> tracks whether an object has ever been opened. This will be nil for an object that starts out open and has never been closed and reopened.</p>
<hr>
<p>If one side of a Door starts out open, the library now assumes that the other side should start out open too.</p>
<hr>
<p>Thing now has a <strong>getFacets</strong> property, which can be set to a list of other Things that are facets of the object it's defined on (and which can thus be regarded as potential pronoun antecedents of the same object). The only objects for which this is automatically set by the library are the two sides of the same door.</p>
<hr>
<p>The <strong>getCarriedBulk()</strong> method now excludes anything fixed in place from its calculation of total bulk as well as anything worn. The reason is that anything fixed in place inside an actor is likely to be a body part, not something carried.</p>
<hr>
<p>The TravelConnector class now has a <strong>noteTraversal(actor)</strong> method which is invoked when it is traversed by <em>actor</em>. The <span class="code">travelDesc</span> method is now called via <span class="code">noteTraversal()</span>. This gives game authors a little more flexibility in defining the side-effects of travel when the traveler is not the player character.</p>
<hr>
<p>TravelConnector's <strong>travelDesc()</strong> method now calls <span class="code">doScript()</span> by default if the TravelConnector in question is also a Script (i.e. EventList). This makes it straightforward to vary the message that is shown when the player character traverses the connector.</p>
<hr>
<p>Room's <strong>roomDaemon()</strong> method now likewise calls <span class="code">doScript()</span> by default if the Room is also a Script. This makes it easy to define a series of atmospheric messages on the Room (simply by mixing it in with an EventList class and giving it an <span class="code">eventList</span> property) </p>
<hr>

<p>The new Thing method <strong>isVehicle</strong> allows a Booth or Platform to be used as a vehicle. If the player issues a travel command while the player character is in (or on) an object for which isVehicle is true, then that object will travel with the player character in (or on) it.</p>
<hr>
<p>It's now possible for Doer's cmd strings to match commands like 'go south' or 'go east|west' and to work as expected (i.e. matching GO SOUTH in the first case and GO EAST or GO WEST in the second). The former method of defining matching directions on the Doer's direction property still remains, both for backward compatibility and because internally the library still uses it (it simply scans the cmd string for direction names and adds the corresponding directions to the Doer's direction property).</p>
<hr>
<p>The Room class now defines two new properties/methods <strong>allowCompassDirections</strong> and <strong>allowShipboardDirections</strong>. If either of these is nil then referring to a compass or shipboard direction respectively in a command will result in the command being blocked with "Compass/Shipboard directions have no meaning here." This check enforced by the new Doer method <strong>checkDirection()</strong>, which is invoked from <span class="code">Doer.exec()</span> if the command refers to a direction. By default allowCompassDirection is true for all rooms (although game code can, of course, override this) whereas <span class="code">allowShipboardDirections</span> is true only on rooms that actually define a non-nil shipboard direction exit (fore, aft, port or starboard). This should make it easier for games to block the execution of seemingly meaningless commands like THROW BALL PORT in locations where PORT has no meaning.</p>
<hr>
<p>The &lt;.roomdesc&gt; <a href="room.htm#styletag">style tag</a> now works (it was ignored before), and a new &lt;.roomcontents&gt; style tag has been added for formatting the listing of a rooms's contents.</p>
<hr>
<p>Bug fixed whereby one got an inappropriate response to FOO ALL when there was nothing available to foo.</p>
<hr>
<p>Bug fixed whereby an adjectival possessive (e.g. "drivers's" in a name like "driver's license") couldn't be matched to the name of an object.</p>
<hr>
<p>Bug fixed whereby the cquoteOutputFilter failed to recognize (and so ignore) HTML tags containing double quote marks (e.g. '&lt;a href="foo" &lt;/a&gt;'. It now does so does not attempt to replace any quotation marks within them. This makes it easier to output strings using the aHref() function or explicit anchor tags. HTML tags containing single quote marks were already recognized before.</p>
<hr>
<p>Bug fixed whereby message parameter substitutions were still a bit too eager to use reflexive pronouns. Reflexive pronouns should now occur only (a) when the parameter explicitly requests them (e.g. {himself dobj}) or when the noun/pronoun being substituted for refers to the same object as the last grammatical subject encountered in the sentence.</p>
<hr>
<p>The subLister (responsible for messages like '(in which was a gold coin)') previous omitted a space after the introductory text (thus producing text like '(in which wasa coin').) This has now been corrected. </p>
<hr>
<br>

<h2><a name="v0.8">Version 0.8 (17 May 2013)</a></h2>

<p><strong>Slight risk of incompatibity:</strong> Some of the DMsg() and BMsg() identifier names have been changed, or messages merged. This is mostly to correct the occurrence of duplicate identifiers that had crept in, but in one or two cases was in the interests of naming consistency (in particular names beginning 'cant' have been changed to names beginning 'cannot'). This will only affect game code if you have defined a <span class="code">CustomMessages</span> object to customize some of the library messages, and even then only a few messages are affected.</p>
<hr>
<p>You can now control whether or not other actors in the vicinity "overhear" information imparted to the current interlocutor. By default a &lt;.inform tag&gt; tag calls the setInformed(tag) on every actor within earshot. This can now be prevented by setting <span class="code">informOverheard = nil</span> on the current ActorState, or <span class="code">actorInformOverheard = nil</span> on the Actor (when the current ActorState is nil). To prevent the overhearing behaviour globally, set <span class="code">informOverheard = nil</span> on the actor or on the whole Actor class.</p>
<hr>
<p>Templates have been added for EventList and ShuffledEventList.</p>
<hr>
<p>The English-language library now automatically sets the name of a thing to the appropriate pronoun ('I', 'we', or 'you') if its <span class="code">person</span> is 1 or 2; this may make it slightly easier to define the player-character object. </p>
<hr>
<p>The new Actor method <strong>travelVia(conn)</strong> makes the actor travel via the TravelConnector <em>conn</em> and reports the actor's movement if it is visible to the player character.</p>

<p>There is also a new Actor method <strong>sayArriving(fromLoc)</strong>, which is called by Actor.travelVia() (as is sayDeparting()). By default sayArriving(fromLoc) calls sayArriving(fromLoc) on the current ActorState which by default in turn calls sayActorArriving(fromLoc) back on the Actor. The sayArriving(fromLoc) method displays only the most basic default message, which most games will probably want to 
customize. It can also be suppressed altogether by supplying nil as the second (optional announceArrival) parameter when calling travelVia(), since it may sometimes be easier to call travelVia() followed by your own custom arrival message than to customize sayArriving().</p>
<hr>
<p>Before Travel notifications are now triggered when an actor tries to travel via a direction that's defined as a method or double-quoted string. That means that when you define the direction property of a Room as a method or double-quoted string, <span class="code">beforeAction(gActor, direction)</span> will be called on every object in scope (allowing any one of them to veto the proposed travel with an exit macro if desired). Note that normally before travel notifications are called as <span class="code">beforeAction(traveler, connector)</span>, but since in this case there's no connector object to pass as a parameter we pass the direction object (e.g. westDir if the actor is trying to go west) instead.</p>

<p>Additionally, if the direction property is defined as a method, then the current room's notifyDeparture(actor, destination) method will be triggered, providing libGlobal.extraDestInfo has a non-nil destination for the proposed travel.</p>
<hr>
<p>The Distant class now defines its <span class="code">decorationActions</span> property as <span class="code">[Examine]</span> only, rather than inheriting <span class="code">[Examine, GoTo]</span> from Decoration. This is probably the better default since most Distant objects are, by their nature, too far away for the player character to go to them (e.f. the sun, moon, sky or a distant mountain). In some cases a Distance object may be 'locally distant', however, such as a sign mounted too high up on the wall to touch. In that case it may be appropriate for game code to override the decorationActions property of the Distant object to include GoTo, since the player might reasonably use GO TO SIGN to take the player character to the location of the sign.</p>
<hr>
<p>It's now possible to set up test scripts for the purposes of debugging which can be run with commands like TEST FOO. For further details see the <a href="debug.htm#tests">Debugging Commands</a> section of the manual.</p>
<hr>
<p>The Parser.defaultActions option has now been switched back on by default. This is the option that allows a command that consists entirely of a noun phrase (such as ME or RED BALL) to be treated as an examine command with the noun as its object. It's now possible to restore this behaviour since the bug that caused it to be a bit too wayward has now been fixed (see below).</p>
<hr>
<p>Game code can now use the tense-switching message substitution <span class="code">{<em>present-str</em>|<em>past-str</em>}</span>; this simply displays <em>past-str</em> if the game is in the past tense and <em>present-str</em> otherwise. This does much the same <span class="code">tSel('present-str', 'past-str')</span>, but does it more concisely.</p>
<hr>
<p>Previously, attempting to use a message parameter substitution verb without a corresponding subject (e.g. "There {is} not much here") would cause a run-time error. Now the English-library defaults to a third-person singular dummy subject in such cases (so that "There {is} no much here" is effectively equivalent to "There {dummy} {is} not much here"). This change avoids the need to include an explicit {dummy} subject in such cases. An explcit dummy {plural} subject is still needed to make the verb take a plural form, however.</p>
<hr>
<p>A number of adv3-style verb conjugation parameters have been added to the English library: {s/d}, {s/ed}, {es/ed}, {ies/ied} and {s/?ed}. These can be use to conjugate regular verbs in message parameter substitions like "{I} close{s/d} the door and cross{es/ed} the room. " In addition, over two hundred irregular verbs are now defined in the English-specific part of the library. This should largely remove the need to define CustomVocab objects (and to check whether they need defining) in order to define new message parameter substitutions for additional verbs, since all regular verbs can now be dealt with the {s/d} type endings, and the library should now recognize most common irregular verbs.</p>
<p>For further details see the sub-section on <a href="message.htm#conjugate_idx">Conjugations and Tenses</a> in the Messages chapter.</p>

The <strong>englishCustomVocab</strong> currently defines a number of regular verbs in its <strong>verbParams</strong> list (along with over 200 irregular ones). These regular verbs are likely to be removed from the list in a future version, since they are no longer needed there. now that the library has an alternative means of conjugating regular verbs. The regular verbs have been left in the list for the time being for backward compatibility. In any case, library messages that make use of such regular verbs will first need to be changed to use the alternative conjugation method (e.g. <span class="code">{achieves}</span> will need to become <span class="code">achieve{s/d}</span>). Game code that uses the old-style message parameter substitutions for regular verb (e.g. <span class="code">{achieves}</span> rather than <span class="code">achieve{s/d}</span>) will not be affected for now, but it will be advisable to replace any such old-style substitutions with the new-style ones in time for the next update.
<hr>
<p>A tweak has been made to the way the message system handles reflexive antecedents. The original Mercury library substituted a reflexive pronoun wherever an object occurred more than once in successionin the same sentence, but this could generate ungrammatical messages such as "You can't take the rug while you're standing on itself." This feature was disabled altogether in an earlier version of adv3Lite, but that meant one might get messages like "You can't eat you" rather than the more grammatical "You can't eat yourself." The reflexive antecedent mechanism has now been tweaked again so that the reflexive pronoun is automatically used when it refers back to the subject of the sentence. There are cases where you might want to use a reflexive pronoun to refer to the object of the sentence, such as the "You can't put the box in itself" example originally envisaged by the Mercury library, but these are usually particular cases where you can use the {himself dobj} message parameter substitution to generate the reflexive pronoun (because, for example, the message is being called from an illogicalSelf() macro in a verify routine to prevent the same object being used in two different and incompatible roles simultaneously).</p>
<hr>
<p>In TADS 3.1.3 and above, it should now be possible to create new adv3Lite projects directly from Workbench's New Project wizard (provided the adv3Lite library directory is where Workbench expects to find it). For details, see the section on <a href="mingame.htm#including_idx">Starting Out — A Minimal Game Definition</a></p>
<hr>
<p>The new Actor method <strong>actorSay(str)</strong> can be used to output a string representing all or part of a conversational exchange in contexts where simply using <span class="code">say()</span> or a double-quoted string could potentially confuse the conversation system and give rise to hard-to-find bugs in game code. For a fuller discussion see the subsections on <a href="tags.htm#actor-tag-idx">Actor-Specific and General Tags</a> and on the use of <a href="initiate.htm#actorsay_idx">actorSay()</a> to initiate NPC conversation.</p>
<hr>
<p>The <span class="code">suggestedTopicLister</span> now separates out the methods <span class="code">showListPrefix(lst, pl, explicit</span>),<span class="code"> showListSuffix(lst, pl, explicit) </span>and <span class="code">showListEmpty(explicit)</span>. This brings it more into line with the Lister class and also makes it easier for game code to customize these parts of a list of suggested topics.</p>
<hr>
<p>The sceneManager now runs the scene-checking mechanism for the first time at the Init stage, i.e. just before the first room description is displayed. Previously, the scene-checking mechanism was run for the first time at the end of the first turn, which made it difficult to define a Scene that starts out active right at the start of play. Note that this means that the <span class="code">whenStarting()</span> method of a Scene whose <span class="code">startsWhen</span> condition starts out true will be executed <em>before</em> the first room description is displayed.</p>

<hr>
<p>The <a href="../libref/index.htm">Library Reference Manual</a> is now included as a standard part of the documentation set. This is the adv3Lite equivalent of the Library Reference Manual that comes with adv3, namely a fully indexed and hyperlinked set of HTML files that allows you to look up every class, object, macro, property, method, or function defined in the library and see where it is defined in the source code, and, in the case of a class or object, what classes it inherits from, and what properties and methods it defines.</p>

<p>The adv3Lite version of the Library Reference Manual additionally includes a Messages tab to help track down library messages and their BMsg or DMsg IDs. Jerry Ford's discovery-tool-generated messages CSV file is also included with the documentation set in order to provide an additional means of searching for library messages. For further details see <a href="message.htm#findingmsg">Finding Message IDs</a> in the Messages chapter.</p>
<hr>
<p>The Library Manual now has an <a href="manual_idx.html">index</a>, which immediately follows this change log.</p>
<hr>
<p>The adv3Lite documentation now provides a link to the <em>TADS 3 System Manual</em> in one or two places. This is done via the file <strong>sysman.htm</strong> in the adv3Lite directory. By default this redirects to the on-line version of the System Manual on www.tads.org, because the location of your local version will vary according to what operating system you're using. If you prefer you can edit sysman.htm to make it redirect to the local copy of the System Manual on your system. For instructions see the section on the <a href="mingame.htm#sysman">System Manual</a> in the setup chapter.</p>
<hr>

<p>Bug fixed whereby every Actor was inadvertently sharing the same informedAboutTab table (so that if one Actor was informed about something, all Actors ended up being informed about it). </p>
<hr>

<p>Bug fixed in which the behaviour of <span class="code">checkReachIn()</span> might not have been what was expected. Previously, checkReachIn() might block reaching from A to B even when A and B were on the same Platform (for example) that defined the checkReachIn() method. That was because the checkReachIn() method used the <span class="code">commonInteriorParent()</span> method to determine whether A was trying to reach inside the object in question, but commonInteriorParent() only counts a parent as common if its a Room or if its contType is In. The library now defines a new <strong>commonContainingParent()</strong> method that finds the common parent in the containment tree regardless of containment type; QDefaults.reachProblemCheck() now uses commonContainingParent() rather than commonInteriorParent() when checking checkReachIn() conditions, which should produce more intuitive results.</p>
<hr>
<p>Bug fixed whereby the <span class="code">sayDeparting()</span> method of FollowAgendaItem did not work as stated in the manual (since it was never being invoked).</p>
<hr>
<p>Bug fixed whereby an apostrophe was incorrectly occurring in certains plurals, e.g. "20's" instead of "20s".</p>
<hr>
<p>Bug fixed whereby responding to a What do you want to foo? prompt when Foo is a LiteralAction might cause a run-time error if the player responded with the name of an object in scope.</p>
<hr>
<p>Bug fixed whereby responding to a What do you want to foo? prompt when Foo is a LiteralAction or TopicAction might cause the response "I don't understand that command" instead of executing the command with the specified literal or topic.</p>
<hr>
<p>Bug fixed whereby the compiler would create a couple of warnings if the game contains no me object (because the player character object is called something else).</p>
<hr>
<p>Bug fixed which could cause a run-time error in calculating scope when the player character isn't the me object.</p>
<hr>
<p>Bug (or bugs?) fixed whereby odd interactions between the parser and the spelling checker could cause seemingly inconsistent responses to commands involving non-existent objects (e.g. X FOO when there's no FOO in the game, or just FOO when defaultActions is true). Thanks are due to Mike Roberts for providing the fix.</p>
<hr>
<p>Bug fixed which truncated the library message shown in the past tense to say that there were no topics to suggest.</p>
<hr>
<br>

<h2><a name="v0.7">Version 0.7 (10 April 2013)</a></h2>
<p><strong>Risk of incompatibity:</strong> The way the <strong>activated</strong> property of an <span class="code">ActorTopicEntry</span> works has been substantially changed. The activated property now starts out true by default on all ActorTopicEntries; if it becomes nil the ActorTopicEntry becomes inactive regardless of the value of its <span class="code">isActive</span> property. Thus, for an ActorTopicEntry to be active, both its <span class="code">isActive</span> property and its <span class="code">activated</span> property must be true.</p>

<p>The <span class="code">&lt;.activate key&gt;</span> tag works as before, setting the <span class="code">activated</span> property to true of all ActorTopicEntries whose convKeys match <em>tag</em>. There is now also a <span class="code">&lt;.deactivate key&gt;</span> tag which does the reverse, i.e. setting the <span class="code">activated</span> property to nil of all ActorTopicEntries whose convKeys match <em>tag</em>. The <span class="code">topicResponse</span> method of an ActorTopicEntry can also call the new <strong>deactivate()</strong> method to deactivate itself, which may be useful, for example, in making an ActorTopicEntry no longer available once it has been viewed.</p>

<p>If you have used the <span class="code">activated</span> property in existing code, search for every ActorTopicEntry in your game that uses the activated property as part of its isActive condition, then remove activated from the <span class="code">isActive</span> condition (or remove the <span class="code">isActive</span> condition altogether if it simply defines <span class="code">isActive = activated</span>) and instead defined <span class="code">activated = nil</span> on the ActorTopicEntry in question.</p>

<p>While this change might be a minor nuisance, it should hopefully make it easier to activate and deactivate ActorTopicEntries in future. For further details see the discussion in the section on <a href="actortopicentry.htm#activated">ActorTopicEntry</a>.</p>
<hr>
<p><strong>Risk of incompatibity:</strong> As many library messages as can be have now been moved off the libMessages object (to make use of BMsg() or DMsg() at the points where they are actually needed in the library). This makes the library message system more consistent, since the libMessages object was largely a historical hang-over. Game code should not be affected unless you have specifically referred to the libMessages object in your code.</p>
<p>It has nevertheless proved necessary to retain the libMessages object for use with the webUI (part of which expects it to be present) and the menu system (which also makes use of it in ways that would be too fiddly to be worth changing). It should not now be used for any other purpose.</p>
<hr>

<p><strong>Slight risk of incompatibity:</strong> A number of redundant methods, properties, and functions have been removed from the library, many of them on Thing or LMentionable. These were methods etc. that were not being used anywhere else in the library and looked unnecessary for author game code. None of them was documented (in the manual or tutorial) and so game code should not have used them.</p>
<hr>
<p><strong>Slight risk of incompatibity:</strong>: At the check stage the preconditions are now checked before the check routines on the direct/indirect object. Previously it was the other way round, but checking the preconditions first seems a more logical order (for example, it means when the player character tries to open an obejct we now check whether the object is touchable before determining whether it's locked, which makes better sense since if the PC can't touch an object s/he may not be able to determine whether it's locked by trying to open it).</p>

<hr>

<p>A new <strong>extraReport()</strong> macro has been added, for use in action() methods. This is to allow an action method to output a brief message like "(with the brass key)" without suppressing the default message from the report stage. It's now used on<span class="code"> dobjFor(Lock)</span> and <span class="code">dobjFor(Unlock)</span> to allow the default messages for these actions to be moved to the report stage, which is more consistent with how other actions work.</p>
<hr>
<p>Actor-initiated conversation via a ConvAgendaItem or TopicEntry now notes the initiating actor as a possible pronoun antecedent (so that, for example, if Bob addresses the player character the player can refer to Bob as 'him' on the next turn).</p>
<hr>
<p>The mechanism by which ' (providing light)' is added to the name of an object in a listing has been made a bit more generalizable. Previously this string was hard-coded into the English-language item lister; now the item lister obtains it from the State object, and the same mechanism could be used to add similar state-specific information from user-defined State objects if so desired. This should make no difference to existing code.</p>
<hr>
<p>GoTo has been added to the list of actions (previously only Examine) that can be performed on a Decoration (since this seems a more natural response to a GO TO command than seeing the notImportantMsg would be), but going to a Decoration is regarded as slightly less logical (logicalRank(90)) than going to a non-Decoration.</p>
<hr>
<p>Where a Room doesn't define a vocab property, it now takes its vocab (and hence its name) from a lower case version of its roomTitle property, provided its autoName property is true. This saves typing the same name twice when the name and the roomTitle are the same (while still allowing them to be different when required). If a Room's roomTitle is meant to be a proper name (such as 'Market Street'), you can prevent the conversion to lower case by defining proper = true on the Room.</p>
<hr>
<p>A <strong>sayDeparting()</strong> method has been added to several classes to provide a default message describing the departure of an NPC. The <span class="code">sayDeparting(traveler)</span> method On <span class="code">TravelConnector</span> describes traveler leaving via that connector. On the base class this is described as the traveler leaving in the appropriate compass direction. On Door, StairwayUp and StairwayDown this is overridden to describe the traveler leaving through the door or up or down the stairway.</p>

<p>The new Actor method <strong>sayDeparting(conn)</strong> calls <strong>sayDeparting(conn)</strong> on the current ActorState which in turn calls <strong>sayActorDeparting(conn)</strong> on the actor which in turn calls <span class="code">sayDeparting()</span> on conn, allowing customization at any point.</p>
<p>At the moment these methods are only used by the new FollowAgendaItem (see below), but they can also be called by game code to describe actor travel as desired.</p>
<hr>
<p>The new Actor methods <strong>sayActorCatches(obj)</strong> and  <strong>sayActorDropsCatch(obj)</strong> have been separated out from the action handling of iobjFor(ThrowTo) to make it easier for game code to customize the messages for an actor catching or failing to catch an object thrown to that actor.</p>
<hr>
<p>The test for <span class="code">Q.canThrowTo(gActor, self)</span> in the action handling of Actor iobjFor(ThrowTo) has been moved from senseRegion.t to actor.t to allow these two files to be included or not included in a project independently of each other. Previously senseRegion.t modified the Actor class, which means actor.t would have had to be present if senseRegion.t was present.</p>
<hr>
<p>The new <strong>FollowAgendaItem</strong> class can be used to make an NPC move along a predefined path in response to a FOLLOW command of which the NPC is the direct object. For example, if Bob has an active <span class="code">FollowAgendaItem</span> then when the player types FOLLOW BOB, Bob will move through the next connector in his FollowAgendaItem's connectorList and the player character will follow him. For details see the section on <a href="agenda.htm#followagenda">AgendaItems</a>.</p>
<hr>
<p>The Thing method <strong>checkReachIn()</strong> now has a second (optional) parameter <em>target</em> which is the object the actor is trying to reach.</p>
<hr>
<p>The library now defines three new macros to act as named constants for use with <a href="initiate.htm#convagendaitem">ConvAgendaItems</a>: <strong>InitiateConversationReason</strong> (1), <strong>ConversationLullReason</strong> (2) and <strong>DefaultTopicReason</strong> (3). This may help make code that uses these constants a little more readable.</p>
<hr>
<p>The quoteFilter OutputFilter object has been moved from actor.r to output.t, where it more logically belongs. This allows games to get the benefit of the quoteFilter (which checks and corrects for unbalanced smart quotes) even when actor.t is not present.</p>
<hr>
<p>When a SpecialTopic is about to create a new Topic object from its matchPattern property (to allow matching Topics to be created on the fly in game code), it first checks that that an equivalent Topic doesn't already exist; if one does exist, the SpecialTopic uses it as its matchObj instead of creating a new Topic for the purpose. This may make for more efficient topic matching.</p>
<hr>
<p>The library now defines an <strong>TellTalkShowTopic</strong> class, which responds to TELL X ABOUT Y or TALK ABOUT Y or SHOW Y</p>
<hr>
<p>The <strong>keyTopics</strong> list property of an ActorTopicEntry can now contain control tags (such as &lt;.arouse key&gt; or &lt;.activate key&gt;) as well as convKeys strings. This is to allow a group of topic entries to be activated or aroused just prior to being suggested; e.g. <span class="code">keyTopics = ['&lt;.activate bob-info&gt;', bob-info]</span>.</p>
<hr>
<p>The library now defines an <strong>ObjectPreCondition</strong> class, which can be used to construct custom preconditions that apply to specific, pre-determined objects,
 rather than the direct/indirect object of the command.</p>
<hr>
<p>The library now defines two new methods on the <span class="code">Region</span> class: <strong>regionBeforeAction</strong> and <strong>regionAfterAction</strong>. These methods are called just before and just after an action takes place in any room in the region.</p>
<hr>
<p>The <span class="code">Mentionable</span> class now defines the <strong>ambiguouslyPlural</strong> property which allows objects with names like 'pair of shoes' or 'flight of stairs' to be referred to as either 'it' or 'them'.</p>

<p>In the English library the <span class="code">ambiguouslyPlural</span> property can be set automatically from the vocab property by including both 'it' and 'them' in the pronoun property. To make the object actually plural, put 'them' first.</p>
<hr>
<p>The new Room method <strong>getDirection(conn)</strong> returns the direction in which one would have to travel from the room in order to travel via <em>conn</em> (i.e. the direction corresponding to the direction property on which <em>conn</em> is defined). For example, if frontDoor was assigned to the north property of a room called hall, <span class="code">hall.getDirection(frontDoor)</span> would return northDir.</p>
<hr>
<p>The new outputFilter method <strong>captureOutputIgnoreExit()</strong> works the same as <span class="code">captureOutput()</span> but attempts to ignore any exit signal thrown by the function whose output it's capturing. This is principally to allow for the use of <span class="code">exit</span> macros in check routines, where they are not needed but may be used by authors used to adv3.</p>
<hr>
<p>The handling of the LookIn, LookUnder and LookBehind actions has been streamlined slightly, to make them more consistent with one another, to make proper use of remapping to appropriate remapXXX objects and refactor some common code into shared methods. Also, <span class="code">lookInMsg</span>, <span class="code">lookUnderMsg</span> and <span class="code">lookBehindMsg</span> are now displayed using the display() method, which means they can be specified as double-quoted strings or methods in addition to single-quoted strings.</p>
<hr>
<p>The Q.reachProblem() method now builds its list of reach problems by calling two new Query methods in succession: reachProblemVerify() and reachProblemCheck(). This allows the touchObj PreCondition to call Q.reachProblemVerify() at the verify stage and Q.reachProblemCheck() at the check stage, which avoids the code relating to the check stage being called twice (with possibly undesirable side-effects). The check code was called twice before since it was part of reachProblem, which was called from the verify stage of touchObj, which is called twice (once for disambiguation, and once when seeing if the action can go ahead).</p>
<hr>
<p>Bug fixed in which included an article ('a' or 'the') in the name of a topic (e.g. ASK BILL FOR THE TIME) could confuse the parser. The English library now strips any articles from the tokens it's trying to match before attempting to match a Topic.</p>
<hr>
<p>Bug fixed whereby "forward" was not recognized by the parser as the name of a direction even though it might be shown in the exit lister. "Fore", "forward" and "f" are now all recognized as referring to the forward direction.</p>
<hr>
<p>Bug fixed whereby the LOCK and UNLOCK commands would ask for a key even when an item was defined as lockableWithoutKey (this bug was introduced in version 0.6).</p>
<hr>
<p>Bug fixed with the capitalization of 'You' in the standard library message for setting something to.</p>
<hr>
<p>Bug fixed whereby attempting to travel through a closed door which may not be opened via an implicit action (because opening the door verifies to <span class="code">nonObvious</span> or <span class="code">dangerous</span>) would display nothing at all, leaving it unclear what had happened. Such travel now results in a message saying that the door is in the way.</p>
<hr>
<p>Bug fixed in the Thing method <span class="code">display(prop)</span>, which failed to display anything if <span class="code">prop</span> was a method that returned a single-quoted string; now the single-quoted string is displayed.</p>
<hr>
<p>Bug fixed whereby using OOPS caused a run-time error.</p>
<hr>
<p>Bug fixed that caused a run-time error with the &lt;.topics&gt; tag.</p>
<hr>
<p>Bug fixed whereby a &lt;.convnode&gt; tag in the invokeItem() method of a ConvAgendaItem didn't work properly when the ConvAgendaItem was triggered by a DefaultAgendaTopic.</p>
<hr>
<p>Bug fixed whereby a QueryTopic template could be misinterpreted (by the compiler) if the QueryTopic was combined with an EventList and the qType and matchPattern were combined in a single string.</p>
<hr>
<p>Bug fixed whereby the suggestedTopicLister would have output a list of AskForTopics twice instead of a list of suggested AskForTopics followed by a list of suggested CommandTopics.</p>
<hr>
<p>Bug fixed whereby making a Component part of something that's not a SimpleAttachment could cause a run-time error at preinit.</p>
<hr>
<p>Bug fixed which stopped the verifyReach() method working properly.</p>
<hr>
<p>Bug fixed whereby an UnlistedProxyConnector (one created using the <span class="code">asExit()</span> macro) might be treated as invisible in the dark even when the connector it was a proxy for was visible.</p>
<hr>
<p>Bug fixed which prevented inheritance of vocab from superclasses after the first member of the class.</p>
<hr>
<p>Bug fixed whereby nothing at all (not even a contents listing) would be shown after the room name for a Room whose desc property had not been defined.</p>
<hr>
<p>Bug fixed whereby the valToList() function failed to return the correct value when its argument was a Vector; it now converts a Vector to a List.</p>
<hr>
<p>Bug fixed whereby use of the <span class="code">exit</span> macro in the checkPreCondition method of a PreCondition would cause the game to terminate with an unknown exception. There is actually no need to use an <span class="code">exit</span> macro in this situation, and game code should avoid doing so, but authors used to adv3 might include one and it is as well for the adv3Lite library to handle it gracefully.</p>
<hr>
<p>Bug fixed whereby <strong>isChild(obj, typ)</strong> and <strong>isDirectChild(obj, typ)</strong> ignored the value of the <em>typ</em> (containment type) parameter. (The Mercury parser uses these methods in a couple of places in contexts where the correction is unlikely to make much practical difference, but the fix has been made just in case, and also just in case game code wants to make direct use of these methods).
</p>
<hr>
<p>Bug fixed in the location method of MultiLoc which could have returned false results when a MultiLoc was located in something other than a top-level room. At the same time the logic of MultiLoc.location() has been overhauled to give more meaningful results in certain other cases.</p>
<hr>
<p>Bug fixed whereby the parser might fail to recognize a response to a disambiguation request as referring to one of the options offered when one of the options is actually a SubComponent (e.g. because a command like LOOK IN BOX has been redirected to the remapIn object of the box, which doesn't have any vocab to match). The matchNameDisambig() method of SubComponent now calls the equivalent method on its lexicalParent to circumvent this problem.</p>
<hr>
<br>

<h2><a name="v0.6">Version 0.6</a> (2 March 2013)</h2>
<p><strong>Risk of incompatibity:</strong> The long form of remap (using <span class="code">remapTo()</span> or <span class="code">maybeRemapTo()</span> or a list defined on a remap property) has been withdrawn. This feature was deprecated from the first, and we said we might withdraw it all along. The same functionality is better implemented using a Doer (see below on the new Doer <span class="code">doInstead()</span> method).</p>
<p>Note that the short form of remap (where remap simply evaluates to another object that replaces the current object in the same command) remains unaffected. The short form remap will remain a permanent part of the library.</p>
<hr>
<p><strong>Risk of incompatibity:</strong> The Doer method <strong>travel()</strong> has been withdrawn, as it is no longer needed. Use the new <strong>doInstead()</strong> method with the new <strong>Go</strong> action instead (see below), e.g. <span class="code">doInstead(Go, northDir)</span>, or, if you prefer, the new <span class="code">goInstead()</span> macro, e.g. <span class="code">goInstead(north)</span></p>
<hr>
<p><strong>Risk of incompatibity:</strong> Some isXXXable properties have been renamed as canXXXMe properties where XXX contains a preposition and the isXXXable form looks too barbarous: e.g. isJumpOffable has been changed to canJumpOffMe.</p>
<hr>
<p><strong>Slight risk of incompatibity:</strong> The <strong>touchObj</strong> PreCondition has been reconfigured to make use of the new Query method <strong>reachProblem(a, b)</strong>. This ensures that almost the entire logic of checking for reachability is handled by the Query object, rather than duplicated between the Query object and the touchObj PreCondition, so that if a Special wants to enforce different reachability rules these will be respected by touchObj without game authors needing to modify touchObj.</p>

<p>The <span class="code">reachProblem()</span> method must return either an empty list (meaning that there's no difficulty with A reaching B) or a list of one or more <strong>ReachProblem</strong> objects. A ReachProblem object must define a <span class="code">verify()</span> method and a <span class="code">check(allowImplicit)</span> method (which can be called by touchObj.verifyPreCondition and touchObj.checkPreCondition respectively). The <span class="code">verify</span> method must either do nothing, or else use the same macros (<span class="code">inaccessible</span>, <span class="code">illogical</span>, <span class="code">implausible</span>, etc.) that are used elsewhere in verify routines. The <span class="code">check</span> method should return true to allow the action to proceed or nil to fail it at the check stage; if it returns nil it should display a message explaining the problem. The check method may optionally also attempt to rectify the problem by carrying out an implicit action.</p>
<p>The <span class="code">reachProblem()</span> method on QDefaults carries out the same checks that were formerly coded directly on <span class="code">touchObj</span>, so game behaviour should not be altered in any way unless your game modifies touchObj.</p>
<p><span class="code">QDefault.canReach(a, b)</span> now returns true if <span class="code">Q.reachProblem(a, b)</span> returns an empty list.</p>
<hr>
<p><strong>Slight risk of incompatibity:</strong> Previously an implicit SAY command (text interpreted as a SAY command during a conversation when the player's command did not explicitly start with SAY) would attempt to match an AskTopic or a TellTopic if it failed to match a SayTopic. This is probably needlessly complex, and may not be altogether intuitive to players. The handling of implicit SAY commands has thus been changed so that the game will only attempt to match SayTopics (including DefaultTopic types that include SayTopics).</p>
<hr>
<p><strong>Slight risk of incompatibity:</strong> The Action methods <strong>getDobj()</strong> and <strong>getIobj()</strong> have been removed. Since all they did was to return <span class="code">curDobj</span> and <span class="code">curIobj</span> respectively, they seemed an unnecessary piece of indirection. It is unlikely that game code would call these methods directly, but if it does, just use <span class="code">curDobj</span> (or <span class="code">gDobj</span>) and <span class="code">curIobj</span> (or <span class="code">gIobj</span>) instead.</p>
<hr>
<p><strong>Slight risk of incompatibity:</strong> A few message properties (particularly relating to scoring) have been moved off the libMessages object and replaced with DMsg/BMsg constructs. The intention is to complete this process in the next release.</p>
<hr>
<p><strong>Slight risk of incompatibity:</strong>  A new <strong>isConnectorVisible</strong> property has been added to <span class="code">TravelConnector</span>. This functions rather like <span class="code">isConnectorApparent</span> did before, but allows isConnectorApparent to be defined as nil or true directly by game authors (instead of being derived from other properties, like <span class="code">isConnectorListed</span> and the lighting conditions. The new set of relationships is now as follows: <span class="code">isConnectorApparent</span> is true by default but can be overridden by game authors. <span class="code">isConnectorListed</span> is <span class="code">(isConnectorApparent)</span> by default but can be separately overridden by game authors. <span class="code">isConnectorVisible</span> is a derived property dependent on the value of <span class="code">isConnectorApparent</span> and the lighting conditions, and should not normally be overridden by game authors (though it obviously can be if special effects are desired). This change is intended to make it easier to make whether or not a connector is listed independent of whether or not it is available for attempted traversal.</p>

<p>Game code that doesn't override any of these properties shouldn't be affected, but if you've overridden isConnectorListed anywhere in your game code you may want to check whether it would be better to override <span class="code">isConnectorApparent</span> instead (since previously the value of <span class="code">isConnectorListed</span> determined the value of <span class="code">isConnectorApparent</span>, but that's no longer the case).</p>
<hr>
<p><strong>Slight risk of incompatibity:</strong> The behaviour of GetOff and GetOutOf has now been decoupled. Previously a GetOff action was simply redirected to a GetOutOf action. The two actions now work very slightly differently, respecting the difference between something an actor is on and something an actor is in. This gives slightly better implicit action reports; it also allows these two (now separate) actions to make proper use of the remapIn and remapOn properties (as Board and Enter now do also) in cases where the object in question implements multiple containment. The TravelAction has also been modified to choose the appropriate action (GetOff or GetOutOf) when responding to an OUT commmand or using an implicit action to get the actor out of his or her immediate container before attempting travel.</p>

<hr>
<p><strong>Very slight risk of incompatibility:</strong> The action handling for a TI action now adds the direct object of a command to it actionList even if the action is dealt with on the indirect object. This is probably better behaviour that what was there before, and means that <span class="code">gActionListStr</span> returns a useful value for report() methods (usually defined on the direct object) even when the action handling has taken place on the indirect object (as may sometimes be more appropriate).</p>
<hr>
<p><strong>Very slight risk of incompatibility:</strong> The action handling for PutIn, PutOn, PutUnder and PutBehind has been moved from the direct object to the indirect object of the action, since game code is more likely to want to customize the effects of the action there (for example, a Container is more likely to behave in a non-standard way to having things inserted in it than the things being inserted in it are).</p>


<hr>
<p><strong>Very slight risk of incompatibility:</strong> The action handling for a number of actions on Thing and one or two other classes has been tweaked to produce a more consistent scheme. Wherever possible, actions that need to be blocked are blocked at the verify stage rather than the check stage, and actions are reported on at the report stage rather than the action stage. This scheme was more or less followed before, but not quite as consistently as it might have been.</p>

<p>Note that there are still some exceptions where (in the first case) it still seems appropriate to perform some additional checks at the check stage and perhaps rule an action out there and (in the second case) where the main point of an action (e.g. EXAMINE, LOOK IN) is the output it produces, which is then best left at the action stage.</p>
<hr>
<p><strong>Very slight risk of incompatibility:</strong> The <strong>scoreObjects()</strong> method of Action now multiplies the verify score by 100 when calculating the overall score for each object in its matchList. This is to allow other scoreObject() methods along the way to tweak the scores of particular objects by small amounts to allow fine tuning of the parser's choice of object while giving priority to the verify results.</p>

<hr>

<p><span class="code">replaceAction()</span> and <span class="code">nestedAction()</span> are now functions, not macros, although they still do exactly the same thing. They are joined by two new functions <span class="code">replaceActorAction()</span> and <span class="code">nestedActorAction()</span>, which can be used when you wish to specify the actor. Game authors are, however, encouraged to use the new methods <span class="code">doInstead()</span> and <span class="code">doNested(</span>) (see below) in place of <span class="code">replaceAction()</span> and <span class="code">nestedAction()</span> since these provide greater functionality and a more consistent interface.</p>
<hr>
<p>Doer, Action, Thing and ActorTopicEntry all define two methods, <strong>doInstead()</strong> and <strong>doNested()</strong> which can be used to divert one action to another (in the first case) or to execute one action in the course of another (in the second case), e.g. <span class="code">doInstead(PutIn, redBall, greenBox)</span> or <span class="code">doNested(Drop, gDobj)</span>. See the discussion on <a href="doer.htm">Doer</a> for details.</p>
<p>Note that the existing Doer method <span class="code">redirect()</span> still exists and works as before, but is now a service method used by <span class="code">doInstead()</span>. Existing code that uses <span class="code">redirect()</span> will still work, but game authors are encouraged to use <span class="code">doInstead()</span> instead.</p>
<hr>
<p>There is now a new <strong>Go</strong> action to make it easier to synthesize travel commands. This action is never triggered directly by a player command, but can be used in doInstead(), doNested, replaceAction(), replaceActorAction, nestedAction() and nestedActorAction() in the form <span class="code">doInstead(Go, northDir)</span>.</p>

<p>If you prefer, you can use the new macros <strong>goInstead()</strong> and <strong>goNested()</strong> instead. For example, <span class="code">goInstead(north)</span> would be exactly equivalent to <span class="code">doInstead(Go, northDir)</span>.</p>
<hr>
<p>A new macro <strong>gActionListObj</strong> has been added for use in report() methods. It evaluates to an object that can be used in situations where we want gActionListStr to be the subject of a sentence (so that any verbs need to agree with it in number depending on whether gReportList represents one or more objects). Consult the section on the <a href="actres.htm#report">Report</a> phase of Actions Results for further details.</p>

<hr>
<p>Two new verification macros have been added: <strong>dangerous</strong> and <strong>nonObvious</strong>. Both of these allow the action to go ahead unless it's an implicit action, but <span class="code">nonObvious</span> is given the same logical rank as <span class="code">illogical</span>. For further details see the <a href="actres.htm#verify">Verify</a> section of the Action Results article.</p>

<p>To allow these two new verification results to work, parts of the verification and implicit action handling have had to be tweaked along with the checkPreCondition methods of most PreConditions. As things stood before it was possible to create a VerifyResult with <span class="code">allowImplicit = nil</span>, but nothing took any notice of this value.</p>
<hr>
<p>Two new macros have been added to assist with verification: <strong>gTentativeDobj</strong> and <strong>gTentativeIobj</strong>. These contain the lists of objects that the current Command is considering as possible direct and indirect objects. These can be used in the verify routines of TIActions on the first object to be resolved when it would be helpful to know what the other object might turn out to be before it has been fully resolved. Note that unlike the similarly named macros in adv3, these ones do actually results in lists of actual objects, not npMatches or the like.</p>

<hr>
<p>A new function <strong>askMissingObject(action, role)</strong> has been added, which may be called via the new macros <strong>askForDobj(action)</strong> and <strong>askForIobj(action)</strong>. This function (or the macros that translate to it) causes the player to be prompted to supply the missing object for <em>action</em> (unless it can find the object for itself, see below), and the input is then parsed in the normal way, as if the query had arisen from the parser; meaning that if the player supplies a valid object <em>action</em> will be executed with that object.</p>

<p>The <span class="code">askMissingObject()</span> function first attempts to find the missing object before prompting the player to supply one. It does so by finding the highest scoring object in scope for the requested role in the requested action. It uses this object if and only if (a) no other object it finds has so high a score and (b) if the action were tried with the object found it would pass the verify stage and would be allowed as an implicitAction (so we don't pick an object with a <span class="code">dangerous</span> or <span class="code">nonObvious</span> verify result, for example). If these conditions are met the requested action is executed with the best match object in the request role without the player being prompted to supply an object.</p>

<hr>
<p>The behaviour of the <strong>Lock</strong> and <strong>Unlock</strong> actions (LOCK DOOR or UNLOCK DOOR without specifying a key) has been altered slightly to take advantage of <span class="code">askForDobj()</span>. Now if the player attempts to lock or unlock something without specifying a key and the player character isn't holding an appropriate key the player is asked to specify a key; previous s/he was told the player character wasn't holding an appropriate key. This seems better behaviour in general, but also in particular when a puzzle requires using something unobvious to unlock (or lock) something with.</p>
<hr>
<p>The behaviour of several other actions  have also been tweaked to take advantage of <span class="code">askMissingObject()</span>, namely Sit, Lie (as in Lie down), Write, Type, and Look up (as in Consult).</p>

<hr>
<p>A number of new actions have now been implemented (more or less completing the set envisaged in the Mercury version of grammar.t apart from some system actions that are being left out on purpose as probably not needed). The new actions include <strong>Lie</strong> (as in lie down, not as in tell an untruth), <strong>PlugIn</strong>, <strong>PlugInto</strong>, <strong>Unplug</strong> and <strong>UnplugFrom</strong>, together with the rest of the PushTravel actions: <strong>PushTravelThrough</strong>, <strong>PushTravelEnter</strong>, <strong>PushTravelGetOutOf</strong>, <strong>PushTravelClimbUp</strong> and <strong>PushTravelClimbDown</strong>.</p>
<hr>
<p>In order to facilitate the implementation of the <span class="code">Plug</span> set of actions a new <strong>PlugAttachable</strong> mix-in class has been added. For details see the appropriate part of the <a href="attachable.htm#plug">Attachables</a> section.</p>
<p>In order to facilitate the implementation of the <span class="code">PlugAttachable</span> class there has been some tweaking of the <span class="code">SimpleAttachable</span> and <span class="code">NearbyAttachable</span> classes, including some changes to the NearbyAttachable class that now make it usable (it was fundamentally broken before).</p>
<hr>
<p>Two new macros <strong>asDobjWithoutVerifyFor()</strong> and <strong>asIobjWithoutVerifyFor()</strong> have been added, which do what they say, namely make one set of action handling routines behave like those of another on the same object, apart from the verify stage.</p>

<p>The main purpose of these new macros is to facilitate a slight tweak in the way the <strong>SitOn</strong>, <strong>StandOn</strong> and <strong>LieOn</strong> actions are implemented. Previously these were treated as synonyms of <span class="code">Board</span>. They still are, except at the verify stage, so that game authors have more control over which items actors can apparently sit, stand or lie on (although there is no difference in the end result). For details see the new paragraph on <a href="thing.htm#posture">Pseudo-Postural Properties</a> in the section on Thing. </p>

<hr>
<p>Four methods have been added to the LMentionable class in the English-specific library to facilitate the manipulation of the vocabulary that can be used to refer to objects (and optionally the name as well): <strong>replaceVocab(voc)</strong>, <strong>addVocab(voc)</strong>, <strong>removeVocabWord(word, matchFlags?)</strong> and <strong>addVocabWord(word, matchFlags)</strong>. For details see the paragraph on <a href="thing.htm#manipulatevocab">Manipulating vocab at run-time</a> in the section on Thing.</p>

<hr>
<p>It's now possible to specify a <strong>matchPhrase</strong> (and, if desired, a separate <strong>disambigMatchPhrase</strong>) that the player's input must match in order to refer to a particular object. For example, if an object with vocab 'dark green bottle; glass' is given a <span class="code">matchPhrase</span> of 'dark green', then it will match DARK GREEN BOTTLE but not just GREEN BOTTLE. For the full story see the paragraph on <a href="thing.htm#phrase">Phrase Matching</a> in the section on Thing.</p>
<hr>
<p>Sections of the vocab property can now be selectively inherited from superclasses. For details, see the explanation of the <a href="thing.htm#inherit">vocab</a> property in the Thing section of the manual.</p>
<hr>
<p>The new Thing property <strong>vocabLikelihood</strong> can be used to make the parser prefer one object over another, other things (notably verify results) being equal. It is recommended that the value given to this property (if it is used at all) be relatively small, say in the range 0 to 10, to ensure that verify results take precedence.</p>

<hr>
<p>There is now a <strong>SecretDoor</strong> class. A SecretDoor is a kind of Door that only acts as a Door when it's open. For details see the <a href="extra.htm#secretdoor">Extras</a> section.</p>

<hr>
<p>Two new classes have been added to the conversation system: <a href="topicgroup.htm">TopicGroup</a> and <a href="convnode.htm#convnode">ConvNode</a> These don't enable game authors to do anything that couldn't be done before, but they may make it more convenient, especially when definining Conversation Nodes.</p>
<hr>
<p>Four new types of DefaultTopic have been added to the conversation system: <strong>DefaultSayTellTopic</strong>, <strong>DefaultTalkTellTopic</strong>, <strong>DefaultSayTellTalkTopic</strong> and <strong>DefaultAskQueryTopic</strong>, since these seem natural groupings for DefaultTopics responding to attempts to impart information or ask questions respectively.</p>
<hr>
<p>The query type and topic vocab of a QueryTopic may now be given together in a single single-quoted string (in the QueryTopic template), e.g. 'where he was born' as an alternative to 'where' 'he was born'.</p>
<hr>
<p>The behaviour of ActorTopicEntry.curiositySatisfied has been changed so that if an ActorTopicEntry defines a non-nil keyTopics property, its curiositySatisfied becomes true if and only if showing a list of the topics it keys would show an empty list (that is, it in effect has no subtopics to suggest). This ensures that ActorTopicEntries whose function is to suggest subtopics are suggested for as long as they have subtopics to suggest.</p>
<hr>
<p>The new gameMain option <strong>againRepeatsParse</strong> controls how the AGAIN command is interpreted. If it is nil AGAIN repeats the resolved command, that is, the command as it was interpreted on the previous turn, with the same objects. If it is true (the default), then the text of the previous command is reparsed, which may result in a different interpretation involving different objects. For example, suppose there are two coins on the floor. If <span class="code">againRepeatsParse</span> is nil then TAKE COIN followed by AGAIN will result in one of the coins beingtaken, followed by an attempt to take the <em>same coin</em> again (which will fail with a message that you're already holding the coin. If <span class="code">againRepeatsParse</span> is true, however, than TAKE COIN followed by AGAIN will result in one coin being taken, and then the other, just as if the player had typed TAKE COIN twice. Which is the better behaviour depends on context; while in the coin example the second interpretation seems better, if a player were to type EXAMINE BOOK and be prompted to say which one, the second interpretation would result in the disambiguation prompt being repeated, which might seem perverse.</p>

<p>There is thus an additional gameMain option <strong>autoSwitchAgain</strong> which tries to give the player the best of both worlds by switching <span class="code">againRepeatsParse</span> between true and nil depending on whether the command to be repeated is the kind of command it would make sense to repeat with the same objects (if it isn't, the command is reparsed in the hope of finding a more sensible match). This is far from absolutely foolproof, and should be regarded as experimental. It is true (switched on) by default, but game authors may wish to set it to nil if it proves troublesome.</p>
<hr>
<p>The new Thing method <strong>fluidName</strong> makes it easier to produce satisfactory messages relating to objects doing duty both as fluid containers and the fluid they contain (e.g. an oilcan notionally containing oil). Library messages referring to drinking and pouring now use the new <span class="code">fluidName</span> property to refer to the direct object of such actions rather than the <span class="code">theName</span> property (although <span class="code">fluidName</span> is set to <span class="code">theName</span> by default).</p>
<hr>
<p>There is now an additional debugging command, DEBUG DOER, which shows which doer (identified by its cmd string) is being executed.</p>
<hr>

<p>The behaviour of the FOLLOW command with an actor as its target has now been enhanced. If the command FOLLOW X is issued and X is not in sight, but the player character is in the location from where s/he last saw X depart, the FOLLOW X command will cause the player character to take the same exit that the player character saw X leave by (i.e. the player character will follow X's last known move). Otherwise, if FOLLOW X is issued when the player character is in the same room as X, then the player character will follow X if X subsequently moves on the same turn.</p>
<hr>
<p>The new function <strong>senseSay(val, obj, prop=&amp;canSee)</strong> can be used to output text only when <em>obj</em> is visible to the player character. This may be particularly useful when reporting the movements and other actions of NPCs who may or may not be visible to the player character.</p>

<p>The new AgendaItem method <strong>report(msg)</strong> simply calls <span class="code">senseSay(msg, getActor)</span>, thereby saving a bit of typing in this commonly useful case. If required <em>report()</em> can pass a property pointer as a second optional parameter (e.g. &amp;canHear) to use a different sense from sight.</p>
<hr>
<p>The draft <a href="../tutorial/toc.htm">Tutorial</a> has now been completed.</p>
<hr>
<p>Work has begun on an <a href="actionref.htm">Action Reference</a>. This is currently still work in progress, but once it is complete it will list all the actions defined in the library referenced by an alphabetical list of the commands used to invoke those actions. Eventually it will also contain summary information about key properties relating to each action and links to further information.</p>
<hr>

<p>Bug fixed whereby the command GO TO X could cause a run-time error when X was last seen in the current location but was no longer there.</p>
<hr>
<p>Bug fixed whereby using an implicit ASK FOR, SHOW or GIVE command (e.g. ASK FOR HELP or SHOW TICKET, without specifiying the addressee) could cause a run-time error: the problem was that no implicit ask for, give to or show to actions had been defined; this has now been remedied.</p>
<hr>
<p>Bug fixed in conversation method Actor.showSuggestions(explicit, tag), where the tag parameter wasn't handled property (leading to bugs and possible run-time errors in handling a TOPICS command).</p>
<hr>
<p>Bug fixed whereby an implicit TOPICS command (e.g. from TALK TO SO-AND-SO) didn't respect the value of the suggestionKey property.</p>
<hr>
<p>Bug fixed whereby a word ending "'s" (apostrophe-S) in the vocab of a Topic would never be matched, because the tokenizer separates the apostrophe-S into a separate token, while the initVocab() routine suppresses it altogether. TopicPhrase now strips any apostrophe-S out of the player's input for the purposes of matching it to a topic so that it doesn't cause a mismatch.</p>
<hr>
<p>Bug fixed whereby trying to UNDOing a SAY command entered without an explicit SAY would undo a previous command instead (since the implicit form of SAY didn't set a savepoint).</p>
<hr>
<p>Bug fixed whereby an AskTopic or TellTopic might be preferred to a SayTopic with the implicit form of the SAY command where the vocabulary overlapped, because only the strongest vocab match was being obtained (which is not necessarily the appropriate behaviour for Topic matches).</p>
<hr>
<p>Bug fixed whereby TopicEntries corresponding to the actors activeKeys list weren't prioritized when the Actor's current ActorState was non-nil.</p>
<hr>
<p>Bug fixed whereby certain forms of Give and Show had the wrong PreConditions. Now GIVE (or GIVE TO) always has an objHeld PreCondition on its direct object, while SHOW and SHOW TO enforce objHeld on portable objects and objVisible on fixed ones.</p>
<hr>
<p>Bug fixed whereby finishOptionScore and finishOptionFullScore weren't causing a display of the final score, but finishOptionScore was generating a spurious additional comma in the list of post-game options.</p>
<hr>
<p>Bug fixed whereby the TAKE FROM command might result in an object being taken even if it was fixed in place.</p>
<hr>
<p>Bug fixed whereby the TAKE FROM command might result in an object being taken even if the actor didn't have room to hold it. The dobj handling of TakeFrom now used the <span class="code">asDobjWithoutVerify()</span> macro to copy all its direct object handling apart from the verify stage from Take, while retaining its own verify handling.</p>
<hr>
<p>Various bugs fixed that could occur when the player character was inside a SubComponent, especially when the SubComponent was closed (thereby preventing the player from referring to the enclosing lexicalParent).</p>
<hr>
<p>Bug fixed whereby the default "You see nothing special..." description was not always shown for objects that lacked a description, so that examining such objects might result in there being no output at all.</p>
<hr>

<br>
<h2><a name="v0.5">Version 0.5</a> (16 January 2013)</h2>
<p>Several changes have been made to the <a href="multiloc.htm">MultiLoc</a> class, partly to fix a bug, and partly to enhance its flexibility.</p>
<p>The problem was that the locationList property was being used for slightly conflicting purposes: both as way to set the initial list of locations in which the MultiLoc should start out and to keep track of the list of locations in which the MultiLoc currently resides. The conflict arose from the fact that it made sense to allow Regions in the list for the first purpose, but not for the second, one slightly obscure consequence of which being that the isDirectlyIn(loc) and isIn(loc) methods behaved unreliably when loc was nil.</p>
<p>MultiLoc now defines a separate <strong>initialLocationList</strong> property for specifying the initial list of locations in which a MultiLoc starts out (which can include Regions), and reserves the locationList property for keeping track of the MultiLoc's current list of locations (rooms and/or objects within rooms, but not Regions; i.e. any Regions specified in the initialLocationList are expanded into their consituent rooms in locationList). However, to maintain backward compatibility and ease of use it is still legal to define an initial list of locations (including Regions) on the locationList property. If the library finds that initialLocationList is empty when it initializes a MultiLoc, it will simply copy the locationList to the initialLocationList before proceeding.</p>
<p>MultiLoc now also defines an <strong>initialLocationClass</strong> property and an <strong>isInitiallyIn(obj)</strong> method, which are intended to work together. If <span class="code">initialLocationClass</span> is not nil then every instance of that class will be added to the MultiLoc's locationList provided <span class="code">isInitiallyIn(obj)</span> returns true for that instance (where <em>obj</em> is the instance in question). This introduces an existing adv3 feature into adv3Lite; the main reason for doing so at this stage is to facilitate the implementation of the new <span class="code">Floor</span> class (see below).</p>
<p>Note that any locations added to the location list via <span class="code">initialLocationClass</span> will be in addition to those defined on <span class="code">initialLocationList</span>, and that any locations defined in the exceptions list will be removed from the location list after those defined in both <span class="code">initialLocationList</span> and <span class="code">initialLocationClass</span> have been added. </p>
<hr>
<p>The <span class="code">addToContents()</span> method of <span class="code">Thing</span> and <span class="code">Region</span> now has a second, optional, parameter <em>vec</em>. This is intended purely for internal use by the library to facilitate initiating the locationList of a MultiLoc from its initialLocationList and initialLocationClass, and shouldn't directly impact on user code.</p>
<hr>
<p>The library now defines a <strong>Floor</strong> class, and one instance of it, <strong>defaultGround</strong>. This is basically a MultiLoc, Decoration that is added into every <a href="room.htm#roomfloor">Room</a>. Its main purpose is to facilitate the parser's ability to disambiguate items by their locations. Formely, if, say, there were two identical coins, one on a table and one directly in the room, the parser would have to ask "Which do you mean, the coin on the table or the coin?", which is unclear and fails to give the player an easy way of selecting the latter. Now the parser can ask "Which do you mean, the coin on the table or the coin on the ground?" and the player can refer to "the coin on the ground" to disambiguate.</p>

<p>The defaultGround object now present in every room does incidentally perform the secondary purpose of allowing players to refer to 'the ground' or 'the floor' which must be implicitly present in nearly every room, but its implementation is deliberately minimalistic to discouraage players from trying to interact with it. The library will translate PUT SOMETHING ON FLOOR or THROW SOMETHING AT FLOOR to DROP SOMETHING, and X GROUND/FLOOR will of course work, as will TAKE X FROM FLOOR, and, in a limited fashion, STAND ON FLOOR or GET ON FLOOR, but that's about it (everything else gets the standard decoration response 'The ground is not important'). STAND ON FLOOR or GET ON FLOOR will either report "You are standing on the floor" (if the player char is in the outermost room) or else be translated into a GetOut action.</p>

<p>If you want to define a custom Floor object for a particular location, or omit it altogether (e.g. for a room at the top of a tree), you can do so by overring the <strong>floorObj</strong> property, either to point to your custom Floor object, or to nil (in the case of a room without a floor). You should do this even if you implement your custom floor object as a Fixture in a single location rather than using the custom Floor class, but you might find it better to use the Floor class even for a custom floor that appears only in one room, since it's designed to facilitate the parser disambiguation just described. If you do decide to define your own Fixture, you'll need to copy most of the methods and properties of the Floor class onto it to make it work properly as a floor.</p>

<hr>
<p>The gameMain option <strong>storeWholeObjectTable</strong> has been removed (and attempting to set it will no longer have any effect). Tests showed that the resources saved by setting this value to nil were negligible. The alternative to storing the whole object table (for use with tags in the conversation system) was always complex and unreliable, and it seemed best just to get rid of it.</p>
<hr>
<p>There are now options to precede the failure messages at produced by check and verify routines with the name of the object they refer to in commands applying to multiple direct objects (e.g. TAKE ALL), in case it isn't clear which objects the messages apply to. These options are controlled by the properties <strong>announceMultiVerify</strong> and <strong>announceMultiCheck</strong>, which can be overridden globally on TAction, or else on individual actions. By default <strong>announceMultiVerify</strong> is nil (most library verify messages make it clear what they refer to) and <strong>announceMultiCheck</strong> is true.</p>
<hr>
<p>Multiple identical verify reports are now suppressed (i.e. only the first is shown). This most commonly pertains when an action applying to multiple direct objects fails the verify test on the indirect object, so that, for example, a command like PUT ALL ON WALLPAPER where the wallpaper is a Decoration would result in multiple displays of "The wallpaper is not important"; clearly the player only needs to see this message once. Note that this repetition suppression only takes place if announceMultiVerify is nil.</p>
<hr>
<p>There is now a DEBUG command that breaks into the debugger, just as it does in adv3. There are also DEBUG ACTIONS, DEBUG MESSAGES and DEBUG SPELLING options. For details see the section in the manual on <a href="debug.htm">Debugging Commands</a>.</p>
<hr>
<p>Thing now has two properties controlling whether you can pour something onto or into the Thing. canPourIntoMe and canPourOntoMe control whether it's possible; by default canPourIntoMe is true if ContType is In and nil otherwise, and canPourOntoMe is true. The properties allowPourIntoMe and allowPourOntoMe control whether you actually want to allow pouring into or onto this object; both are nil by default. This ensures that a game will give a reasonably sensible response where the canPour property of some object has been set to true and there's no other specific handling on objects that might be poured into or onto.</p>
<hr>
<p>The {I} and {me} message parameter substitutions now use the theName and theObjName properties of the actor rather than the name and objName properties; this generally reads more naturally.</p>
<hr>
<p>Bug fixed that caused a run-time error in the GoOut action (the action triggered by EXIT or LEAVE), and in the GoIn action (triggered by ENTER without an object).</p>
<hr>
<p>Bug fixed that caused a run-time when the player attempted to issue an order to an NPC (or even the PC) with the "bob, whatever" syntax.</p>
<hr>
<p>Bug fixed that caused things with <span class="code">visibleInDark = true</span> not to be visible in the dark.</p>
<hr>
<p>Bug fixed that could wrongly suppress action reports at the report() stage when Doer.redirect() was used.</p>
<hr>
<p>Bug fixed that placed the player character's immediate container out of reach of the player character.</p>
<hr>
<p>Bug fixed whereby the actionPhrase() method used to reconstruct the text of a command in a CommandTopic or DefaultCommandTopic failed to use the correct pronouns when one of the objects of the command was either the player character or the actor at whom the command was targeted. These are now rendered as 'me' or 'yourself' respectively, since the text output by actionPhrase() is intended to be used in the representation of the direct speech of the player character to the target actor.</p>
<hr>
<p>Bug fixed whereby a Doer redirect aimed at a specific object would apply to all successive objects on the same command (for example if a Doer redirected TAKE BLUE BALL to the Examine action, TAKE ALL would result in everything processed after the blue ball in the same command being examined as well).</p>
<hr>
<p>Bug fixed whereby detaching an object from another object left it located in the other object (and thus seemingly still attached); the detached object was being move to its own location (which left it where it was) instead of the location of the object it had just been detached from.</p>
<hr>
<p>Bug fixed whereby opening a container would report "Opening the X reveals Y" followed by an unnecessary "You open the X" (due to inappropriate recursive sublisting).</p>
<hr>
<p>Bug fixed whereby trying to drop a fixture would result in the odd message "The whatever is part of you" instead of "You aren't holding the whatever".</p>
<hr>
<p>Bug fixed whereby the message reporting that a particular key wouldn't work on a particular objecty caused a run-time error.</p>
<hr>
<p>Bug fixed whereby the antecedent of a pronoun could become a SubComponent rather than the object of which it is a part. For example the sequence OPEN SUITCASE. TAKE IT. Might mysteriously generate the response "The suitcase is fixed in place" because IT now referred to the SubComponent representing the suitcase's interior rather than the suitcase itself.</p>
<br>

<h2><a name="v0.4">Version 0.4</a> (12 January 2013)</h2>
<p><strong>Risk of incompatibility:</strong> The properties <span class="code">allowPutIn</span>, <span class="code">allowPutUnder</span> and <span class="code">allowPutBehind</span> have been renamed <strong>canPutInMe</strong>, <strong>canPutUnderMe</strong> and <strong>canPutBehindMe</strong> to make these names more consistent with the naming scheme used elsewhere in the library. By default these properties are true if the contType is of the appropriate type (In, Under or Behind respectively). If one of these properties is overridden to true and the contType is not of the appropriate type, any item put in, under or behind the object in question will be stored in its hiddenIn, hiddenUnder or hiddenBehind property and moved into nil. Note that there is no canPutOnMe property, since the hiddenOn property that would then be needed wouldn't make much sense, and it wouldn't make any sense to allow game authors to override the rule that items can be put on an object if and only if its contType is On.</p>
<hr>
<p><strong>Risk of incompatibility:</strong> The Thing property transparent has been renamed <strong>isTransparent</strong> to bring its name into line with similar properties of Thing.</p>
<hr>
<p><strong>Risk of incompatibility:</strong> The default value of the <strong>specialDescBeforeContents</strong> property of Thing has been hanged from true to <span class="code">(location && location.ofKind(Room))</span>. In other words the default is true for an object directly in a room and nil otherwise. This gives more satisfactory results for specialDescs shown as part of the listing of the contents of some other item, where the contents lister for that item may already have introduced the fact that its contents are about to be shown.</p>
<hr>
<p>Correspondingly, the specialDescs of items contained in other objects are now listed (as well as the listing of any other items). Previously this was not the case, which was arguably a bug.</p>
<hr>
<p><strong>Risk of incompatibility:</strong> The handling of KISS and ATTACK on the Actor class has changed. The default behaviour is now to display the actor's shouldNotKissMsg or shouldNotAttackMsg (at the check stage). If you want to use KissTopics and HitTopics (or you want to define your own handling at the action stage), set <span class="code">allowKiss</span> and/or <span class="code">allowAttack</span> to true.</p> 

<p>The reason for this change is that defining a shouldNotKissMsg and/or shouldNotAttackMsg is more straightfoward than having to define a complete KissTopic or HitTopic for the great majority of actors who do not need this kind of fine tuning.</p>
<hr>
<p><strong>Minor risk of incompatibility:</strong> The Thing properties <strong>openingContainerMsg</strong> has been withdrawn, since its function is now performed by <strong>openingContentsLister</strong>. The  <strong>okayOpenMsg</strong> property is now employed at the report() stage of dobjFor(Open) and is intended primarily for doors.</p>

<hr>

<p>An optional parameter, <span class="code">paraBrk</span>, has been added to the show() method of Lister. The default value of this parameter is true, but if it is passed as nil the paragraph break at the end of the list is suppressed. This change has been introduced mainly to facilitate several of the listing changes that follow, and may not have much effect on game code.</p>
<hr>
<p>The Thing method listSubcontentsOf() now takes a second parameter, namely the lister to be used for the listing of any miscellaneous items. The default is examineLister (which is now a property of Thing). Since this method is mainly used internally in the library this changhe may have little direct on game code, but in principle the method is also available to be called from game code.</p>
<hr>
<p>The inventory lister now splits worn items and carried items into two different lists (e.g. "You are wearing an old coat and a silly hat, and you are carrying a walking stick and a pencil.") If you prefer the single listing style, override Inventory.splitListing to nil.</p>
<hr>
<p>The depth of listing contents of contents in inventory listings can now be controlled by the value of <strong>subLister.maxNestingDepth</strong>. The default is 1, which gives results like "You are carrying a glass box (in which is a red box)". A value of 2, for example, would give "You are carrying a glass box (in which is a red box (in which is a battery))."</p>
<hr>
<p>Miscellaneous items in room listings and items that are examined and have visible contents may now list their contents in parentheses immediately after their name to the depth defined in subLister.maxNestingDepth. To enable this style of listing set <strong>gameMain.useParentheticalListing</strong> to true. To change the behaviour of individual listers (examineLister, openableContentsLister and RoomContentsLister) override their showSubListing property to true or nil (rather than having them pick it up from gameMain.useParentheticalListing).</p>
<hr>
<p>Paragraph breaks between the sentences listing the contents of items in a room description can be suppressed by setting <strong>paraBrksBtwnSubcontents</strong> to nil, either on a room-by-room basis or globally on gameMain. For further details on this and the previous change consult the section on <a href="roomdesc.htm#further">Room Descriptions</a>.</p>
<hr>

<p>The room contents listing has been tweaked so that if the actor looking around is not directly in a room, the actor's immediate location is mentioned first (e.g. "You are in a big wooden box") followed by a listing of the location's contents.</p>
<hr>
<p>The listing mechanism has been thoroughly overhauled to make fuller use of Lister objects. A new subclass of Lister, <span class="code">ItemLister</span>, is now used as the base class for several kinds of lister used in room, examine and search listings. The ItemLister class defines a <span class="code">contentsListedProp</span>, the default value of which is <span class="code">&amp;contentsListed</span>; this is the property defined on the object whose contents are to be listed that determines whether that object wishes to allow its contents to be listed.</p>

<p>As a result of these changes the library should now respect the values of the Thing properties <strong>lookListed</strong>, <strong>examineListed</strong>, <strong>searchListed</strong>, <strong>contentsListedInLook</strong>, <strong>contentsListedInExamine</strong> and <strong>contentsListedInSearch</strong>. The first three of these determine whether an item is listed as part of the miscellaneous contents of its parent in response to a LOOK command, or when its parent is EXAMINED, or when its parent is searched (with SEARCH or LOOK IN/UNDER/BEHIND) respectively. The second three determine whether the contents of the item on which it is defined are listed in response to a LOOK, EXAMINE or SEARCH command. By default <span class="code">examineListed</span>, <span class="code">lookListed</span> and <span class="code">searchListed</span> all take their value from the <span class="code">isListed</span> property. The <span class="code">contentsListedInLook</span> and <span class="code">contentsListedInExamine</span> properties both take their default values from the <span class="code">contentsListed</span> property (which is true by default). The default value of <span class="code">contentsListedInSearch</span>, however, is simply <span class="code">true</span>, since it's hard to think of many cases where you wouldn't want an object to reveal its contents when explicitly searched; the property is nevertheless provided for completeness.</p>

<p>The new Thing property <strong>examineLister</strong> defines the lister to be used to list an object's contents when it is examined. The default value is <span class="code">descContentsLister</span>.</p>
<hr>
<p>Perhaps somewhat experimentally, the various listers now attempt two consolidate multiple identical items in a list into a single enumerated occurrence, so that, for example, instead of "You are carrying a gold coin, a gold coin and a gold coin" the game will output "You are carrying three gold coins." I have marked this as experimental in case there are instances where it does not work appropriately.</p>
<hr>
<p>A new function, <strong>makeMentioned(obj)</strong>, has been added that simply makes obj.mentioned true. The obj parameter can also be a list of Things, in which case each item in the list will be marked as mentioned. With a embedded expression the same function can be written as &lt;&lt; exclude obj &gt;&gt;. The purpose of the function is to allow game authors to exclude certain items from room (and other listings), perhaps because they've already mentioned them under another name or description.</p>
<hr>
<p>Two new Thing properties <strong>allowReachOut(obj)</strong> and <strong>autoGetOutToReach</strong> have been added to allow game authors to control what happens when an actor tries to reach one object from within another (e.g. while the actor is on a bed or chair and tries to reach something elsewhere in the room). These properties should be defined on the object the actor is in. If <span class="code">allowReachOut(obj)</span> returns true for the obj the actor is trying to reach (the default), then reaching is allowed. Otherwise, if <span class="code">autoGetOutToReach</span> is true (the default) the actor will try to get out of his/her immediate container to reach the object. Otherwise (if <span class="code">autoGetOutToReach</span> is nil) reaching is prohibited and a message is displayed saying that the actor can't reach the target object from his/her present location.</p>
<hr>

<p>The new Thing method <strong>checkReachIn(actor)</strong> can be used to put the contents of an object out of reach of an actor outside the object (for reasons other than enclosure), e.g. if the object is meant to be out of reach. The default behaviour is to put the contents of an object out of reach if its own <span class="code">checkReach(actor)</span> method puts it out of reach; <span class="code">checkReachIn(actor)</span> simply calls <span class="code">checkReach(actor)</span>. The contents of the object are considered out of reach if its <span class="code">checkReachIn()</span> method dislays anything at all.</p>
<hr>
<p>Thing now defines three new properties, <strong>maxBulkHiddenIn</strong>, <strong>maxBulkHiddenUnder</strong> and <strong>maxBulkHiddenBehind</strong> that limit the amount that can be but in, under or behind an object that ends up in hiddenIn, hiddenUnder or hiddenBehind list. The corresponding methods <span class="code">getBulkHiddenIn</span>, <span class="code">getBulkHiddenUnder</span> and <span class="code">getBulkHiddenBehind</span> return the total bulk of the items currently contained in the corresponding lists.</p>

<hr>
<p>It's now legal to use the name of the lexicalParent instead of its remapIn property when defining the objects a Key locks and unlocks in the plausibleKeyList and actualKeyList properties of a Key. For example, in the following definition the silver key will work as presumably intended:</p>

<p><div class="code"><pre>
cabinet: Fixture 'cabinet'
   remapIn: SubComponent
   {
      lockability = lockableWithKey
      isLocked = true
      isOpenable = true
    }
    
    remapOn: SubComponent {}
;

silverKey: Key 'silver key'
   plausibleLockList = [cabinet]
   actualLockList = [cabinet]
;
</pre></div></p>



<hr>
<p><span class="code">QDefaults.canReach(a, b)</span> has been amended to take account of the checkReach() and checkReachIn() methods of the objects along the containment path from a to b.</p>

<hr>
<p>Room and Region both now define two new methods: <strong>travelerLeaving(traveler, dest)</strong> and <strong>travelerEntering(traveler, dest)</strong>. These are both invoked just before travel actually takes place, the first on the room or region that's about to be left, and the second on the room or region that's about to be entered. The traveler parameter is the actor doing the traveling, while dest is the room that's about to be entered. These methods are only called on regions when the starting room and destination rooms are in one or more regions that are not common to them both.</p>
<hr>

<p>The checkRoomToHold() method (used by the TAKE action to enforce inventory limits) now uses the new method getBulkCarried() instead of getBulkWithin() as before; getBulkCarried() excludes items that are being worn from the total, since these presumably do not contribute to the total bulk carried in an actor's hands. The Doff action therefore now also enforces checkRoomToHold() in its check() method.</p>
<hr>
<p>The default value of <strong>disambigOrder</strong> (a property of Mentionable) has been changed to <span class="code">(listOrder)</span>, and that of <strong>disambigGroup</strong> has been changed from nil to 0 (zero). This means that the default behaviour of the library will be to list items in disambiguation prompts in the order of their listOrder property, which is probably what's most frequently required when a listOrder has been specified. </p>
<hr>
<p>The attempt to implicitly open a closed door before travelling through it has been moved from the travelVia() method to the execTravel() method of the Door class. This means that the before travel notifications are carried out before any attempt is made to open the door, which gives better results when travel via the door is prohibited (by an NPC, for example).</p>
<hr>
<p>The function <span class="code">makeListStr(lst)</span> now sorts the objects in lst in ascending order of their listOrder property before constructing the string version of the list.</p>
<hr>
<p>The handling of the PURLOIN debugging verb has been changed so that it's no longer possible to purloin objects that are fixed in place. Purloining a fixed object causes it to become a component of the player character (which probably isn't what's intended) and risks playing havoc with the world model, so it seems better to rule it out. If authors/testers really need to move fixed objects around this can be done with EVAL obj.moveInto(wherever).</p>
<hr>
<p>The grammar for the EXAMINE verb has been extended so that it will look accept LOOK X or L X as well as LOOK AT X or L AT X (plus the other various valid forms).</p>
<hr>
<p>The Lever class now as an <span class="code">isPushed</span> property as well as an <span class="code">isPulled</span> property. By default isPushed = !isPulled, but the existence of the separate isPushed property makes it easier to decouple the two if you want a lever that can also be in a position between the two extremes (when both isPushed and isPulled would be nil). The verify routine for dobjFor(Push) on the Lever thus now tests for isPushed rather than !isPulled.</p>
<hr>
<p>GameMainDef.newGame() now sets gAction to a new Look action (the action effectively about to be performed just before the first turn) and gActor to the player character. This makes it more likely that any user startup code that assumes the extistence of an action context, such as using <span class="code">gMessageParams()</span> in gameMain.showIntro() or within the initial room description, will work as expected rather than causing a run-time error.</p>
<hr>
<p>The message parameter substitutions {a obj}, {an obj}, {a subj obj} and {an subj obj} have been added; these work just like {the obj} and {the subj obj} but use the indefinite article instead of the definite article (or rather the aName property of obj rather than the theName property).</p>
<hr>
<p>Parser.defaultActions is now nil by default. This means that the parser no longer tries to treat commands it doesn't understand as possible noun phrases referring to the direct object of an EXAMINE command (or a GO TO command for rooms). The behavior during conversations is not affected; any command the parser can't make sense of during a conversation is still taken as a SAY command. The former behaviour (i.e. with FOO treated as EXAMINE FOO) was causing inconsistent behaviour (sometimes reporting 'You see no foo here' and sometimes reporting 'I don't understand that command' with no apparent rhyme or reason). Since it is not normal IF parser behaviour (to treat a command consisting purely as a noun phrase as the target of an unstated EXAMINE or other default command), it seems reasonable to turn this behaviour off by default. Game authors who want this behaviour can restore it by setting Parser.defaultActions to true (or could provide a custom command to allow players to turn it on and off).</p>
<hr>
<p>The <span class="code">StairwayUp</span>, <span class="code">StairwayDown</span> and <span class="code">Passage</span> classes have been amended to respect the values ot the <span class="code">isClimbable</span>, <span class="code">isClimbDownable</span> and <span class="code">isGoThroughable</span> properties respectively (these properties now being true by default for each of these classes in turn). Previously these classes overrid the verify() methods supplied by Thing so that these properties were effectively ignored, which made the behaviour of these classes inconsistent with what users might reasonably expect.</p>
<hr>
<p>Bug fixed in which a dropped object was moved into the actor's outermost room instead of the immediate location. The new Thing property <strong>dropLocation</strong> now defines where an object dropped in a location should land. By default dropLocation is simply self.</p>
<hr>
<p>Bug fixed which could cause a run-time error when the player supplied the missing noun of a command in response to a parser query.</p>
<hr>
<p>The bug that prevented a Doer from always matching a command specification involving specific problems has re-emerged, and has once again been fixed.</p>
<hr>
<p>Bug fixed in which the HTML entities &amp;rdquo; and &amp;ldquo; used to replace double-quote marks in textual outpit lacked the terminating semilcolon.</p>
<hr>
<p>Bug fixed whereby the parser would ask a pointless disambiguation question in response to a command involving one of a number of identical objects; e.g. TAKE COIN would result in the message, "Which to do mean, a coin?".</p>
<hr>
<p>Bug fixed whereby commands involving a specified number of objects would sometimes result in the parser making perverse choices; for example, if there were two coins on the floor and a third being carried by the player, TAKE TWO COINS might be interpreted to mean taking one of the coins on the floor plus the one the player character already holds, instead of the two on the floor as the player presumably intended.</p>
<hr>
<p>Bug fixed whereby commands involving a specified number of objects would result in the wrong error message if more objects were specified than were available; for example TAKE FOUR COINS might result in "You see no four coins here" instead of "There aren't that many available."</p>
<hr>
<p>Various bugs fixed concerning the resolution of the pronouns 'you' and 'your', including the bug that caused a crash when 'your' was used in a command and the failure of the parser to recognize that 'you' and 'your' referred to the player character in contexts where this would be the player's clear intention.</p>
<hr>
<p>Various bugs fixed concerning inappropriate or run-time-error-causing error-messages when a command referred to something by its owner (e.g. X BOB'S COIN when Bob doesn't have a coin).</p>
<hr>
<br>




<h2><a name="v0.3">Version 0.3</a> (18 December 2012)</h2>
<p><strong>Risk of incompatibility:</strong> The Thing property <strong>nothingThroughMsg</strong> has been renamed <strong>lookThroughMsg</strong>, which better reflects its function. The default text of this message remains unchanged.</p>

<p>Similarly nothingInMsg, nothingUnderMsg and nothingBehindMsg have been renamed lookInMsg, lookUnderMsg and lookBehindMsg.</p>
<hr>
<p><strong>Risk of incompatibility:</strong> The Thing properties <strong>autoTakeOnLookUnder</strong> and <strong>autoTakeOnLookBehind</strong> have been abolished, and the behaviour of LOOK BEHIND and LOOK UNDER slightly changed. Two new properties and three new methods have been introduced instead. Tne new <strong>autoTakeOnFindHidden</strong> property determines whether an object may be automatically taken when it's moved from a hiddenXXXX list. The default value of autoTakeOnFindHidden is (isFixed), the idea being that if we look in, under, or behind something fixed (like a pile of junk or a piece of furniture) and there's nowhere else for the objects discovered to go, we'll probably take them, but that if we look under or behind something portable, like a rug or a blanket, we probably move the rug or blanket a little to do so and leave the item discovered where it notionally was all along (in the same location as the portable item we've just looked under/behind). The new property <strong>findHiddenDest</strong> determines where an object is moved to from a hiddenXXXX list (when there's no obvious container for it); by default if autoTakeOnFindHidden is true, then findHiddenDest is gActor (the actor who will take the items discovered), otherwise it's the location of the object that's just been looked in/under/behind. These properties are actually used in the three new methods <strong>findHiddenIn()</strong>, <strong>findHiddenUnder()</strong>, and <strong>findHiddenBehind()</strong>.</p>

<p>The sequence of events with LOOK UNDER X is now as follows:</p>
<ol>
<li>If X has a contType of Under then this is the target object we'll work with.</li>
<li>Otherwise, if it has an associated remapUnder object, we'll work with that.</li>
<li>If the target object has a contType of Under then move everything from the hiddenUnder list to the target object and then list the contents of the target object as being underneath it (or say there's nothing under it if there's nothing there).</li>
<li>Otherwise, if there's anything in the hiddenUnder list, call findHiddenUnder().</li>
<li>Otherwise, say there's nothing there.</li>
</ol>

<p>The findHiddenUnder() method then moves everything from the hiddenUnder list to findHiddenDest and displays an appropriate message.</p>

<p>LOOK IN X and LOOK BEHIND X work in much the same way (except with hiddenIn and hiddenBehind respectively and contTypes of In and Behind respectively).</p>

<p>This may all seem a bit complicated, but it should provide reasonable default behaviour most of the time, while being relatively easy to customize for exceptional cases.</p>

<hr>
<p>A <strong>hiddenIn</strong> property has been added to Thing. It can be used in much the same way as hiddenUnder or hiddenBehind now do. It can be used either for objects in a container that won't be noticed until the container is explicitly searched or for objects hidden in things like piles of junk or haystacks that aren't containers in the normal sense.</p>
<hr>
<p>The action handling for ENTER has been decoupled from that for BOARD (along with the vocabulary used to trigger these actions). ENTER now handles getting inside something that has a contType of In. BOARD handles getting on something that has a contType of On. The new isEnterable flag determines whether an actor can get inside something (the contType must also be In). Note that this does not effect the Enterable class (which is used for things like buildings which can be entered by traveling to a new room representing their interior), but that the Booth class is now defined with isEnterable = true rather than isBoardable = true.</p>
<hr>
<p>A number of methods (such as lookAroundWithin() and methods it calls) have been moved from Room to Thing. This is to allow a Thing (particularly a closed Booth) to describe its interior properly when the player character is contained within it. Since Room inherits from Thing, this should not affect any existing code.</p>
<hr>
<p>In several places getOutermostRoom (in particular gPlayerChar.getOutermostRoom) has been replaced with outermostVisibleParent() (e.g. in the implementation of the LOOK command, and in other places where a look around is performed) to ensure that the right description is presented when looking around from within a closed container (such as a booth).</p>
<hr>
<p>Thing.statusName(actor) has been amended to give sensible results when looking around from within a closed container.</p>
<hr>
<p>A new <strong>interiorDesc</strong> property has been added to Thing. This is used as the room description when looking around from inside a closed container.</p>
<hr>
<p>The touchObj precondition and the QDefaults.canReach() method have been changed so that if the object that one is trying to reach is the object that's blocking the reach path, it's now considered touchable. This is to allow, for example, an actor to open a closed container from the inside (previously you would have got a message like "You can't reach the large wooden box through the large wooden box.")</p>
<hr>
<p>The default value of Thing.isOpen has been changed from nil to (!isOpenable). This makes the definition of a simple container (by adding contType = In) just a little easier and more intuitive, and so is probably the better default case. Note that this doesn't effect the Container class (which already defines isOpen = true) or the OpenableContainer class (which defines isOpen = nil). The isOpen property of Door is now explicitly nil by default to ensure that doors normally start out closed.</p>
<hr>
<p>The handling of the INVENTORY command has been changed to make use of inventoryLister. inventoryLister has been changed to optionally allow the display of additional information (such as 'providing light') after the names of items in an inventory list, and to optionally display the contents of items in an inventory list (e.g. 'You are carrying a big bag (in which is a blue ball). '). To facilitate the latter a new subLister has been created and a new buildList() method added to the Lister class. The buildList(lst) method returns a single-quoted string containing what show(list, 0) would have displayed, minus the terminating paragraph break.</p>
<hr>
<p>Two new properties <strong>isProminentSmell</strong> and <strong>isProminentNoise</strong> have been added to Thing, both true by default. The smellDesc and listenDesc properties of an object are only displayed in response to an <em>intransitive</em> SMELL or LISTEN command respectively if these properties are true. These properties have no effect on the transitive SMELL SOMETHING and LISTEN TO SOMETHING commands. This allows game authors to exclude items being listed in response to an intransitve LISTEN or SMELL while still making them respond to being explicitly listened to or smelled.</p>
<hr>
<p>A number of redundant methods (that aren't actually used anywhere) have been removed, such as Thing.lookAround(pov). These are generally methods that were defined in Mercury or adv3 but which are not needed in adv3Lite, either because they have no function in adv3Lite at all (such as some of the methods and properties relating to senseCache on libGlobal) or because adv3Lite defines its own version to perform the appropriate function (e.g. lookAround(pov) is not needed because adv3Lite defines lookAroundWithin()).</p>
<hr>
<p>The Actor class now defines <span class="code">contType = Carrier</span> by default (as it should have done all along).</p>
<hr>
<p>The Thing class now has a new <span class="code">display(prop)</span> method, where prop is a property pointer. If prop contains a double-quoted string or a method, the display() method simply calls <span class="code">self.(prop)</span>. If prop contains a single-quoted string or integer, display calls <span class="code">say(self.(prop))</span>. This simplifies the creation of code that will display a text property correctly whether it has been defines as a single-quoted string, a double-quoted string and a method, and several routines have been adapted to take advantage of it.</p>
<hr>
<p>It's now possible to prevent the use of ALL (e.g. EXAMINE ALL) with all but basic inventory handling verbs (TAKE, DROP, PUT and DOFF). Some people feel that the use of ALL with all the other verbs (EXAMINE ALL, SHOW ALL TO FRED etc.) allows a bit too much of a blunderbus approach to playing Interactive Fiction. If you wish to disable it, you can define the new <strong>allVerbsAllowAll</strong> property on gameMain to be nil (the default is true). You can also allow and disallow ALL for individual actions by setting their <strong>allowAll</strong> property to true or nil (which takes precedence over the allVerbsAllowAll setting).</p>
<hr>
<p>The library now defines SIT ON and LIE ON actions. The default behaviour is simply to BOARD the object in question, since avd3Lite does not provide any support for postures. Games can override SIT ON and LIE ON to do something different if they need to. STAND IN, SIT IN and LIE IN actions have also been added; by default they're all equivalent to ENTER (although again this can be overridden). If you want SIT ON & SIT IN (or LIE ON and LIE IN) to act equivalently, e.g. for a chair or bed, define the chair or bed as a Surface with <span class="code">isBoardable = true</span>and <span class="code">dobjFor(Enter) asDobjFor(Board)</span>.</p>
<hr>
<p>The library now suppresses the default "You see nothing special about the whatever" description of an object when the object has any state-specific information to add to its description. (This only makes a difference to objects where the author hasn't explicitly defined the desc property).</p>
<hr>
<p>If the actor is in a "NestedRoom" (i.e. a Container or Surface rather than a Room) then the command OUT now takes the actor out of the actor's immediate location; previously it was taken to be a command to leave the Room.</p>
<hr>
<p>Bug fixed whereby at several places in the library the non-existent property isPlural was referenced instead of the correct property, plural. Note however that this may change in a future release where 'is' may be prefixed to several property names (plural, transparent etc.) to provide a more consistent naming scheme across the library.</p>
<hr>
<p>Bug fixed whereby opening a container caused all its contents to be listed, instead of only its listable contents.</p>
<hr>
<p>Bug fixed that could prevent a Doer properly matching certain TI Actions for which resolveIobjFirst = true (since this caused the Doer matching mechanism to see the direct and indirect objects in reverse order).</p>
<hr>
<p>Bug fixed whereby a light source in a closed transparent container failed to illuminate a room.</p>
<hr>
<p>Bug fixed whereby when an action was applied to multiple objects and the name of each object was announced, any implied action reports came before the name of the object instead of after.</p>
<hr>
<p>Bug fixed whereby a run-time error could occur when verifying the second object of a TIAction when the verify routine depended on the first object having been identified but the first object had been selected without any need for disambiguation.</p>
<hr>
<p>Bug fixed whereby an actor getting off something that had an associated container attached (a table with a drawer, say) would cause an implied action opening the associated container.</p>
<hr>
<br>


<h2><a name="v0.2">Version 0.2</a> (November 2012)</h2>

<p>Facilities added to allow better control over the way items are displayed in room descriptions. The <strong>specialDescOrder</strong> property can now be used to control the order in which specialDescs are shown. The <strong>specialDescBeforeContents</strong> property can be used to show whether an item's specialDesc should be shown before or after the listing of miscellaneous items in the the room description. The &lt;&lt;list of&gt;&gt; &lt;&lt;list of is&gt;&gt; and &lt;&lt;is list of&gt;&gt; embedded expressions can be used to customize the way an item's contents are listed in a room description. The &lt;&lt;mention a&gt;&gt; and &lt;&lt;mention the&gt;&gt; embedded expressions can be used to have one item in a room description listing mention another (and thereby suppress the subsequent listing of the same item). For full details see the new section on <a href="roomdesc.htm">Room Descriptions</a>.
<hr>
<p>The new <strong>SenseRegion</strong> class can be used to define regions with sensory connections, that is regions where it is possible to see (and possibly smell and hear) ojects in one room from another. For details see the new <a href="senseregion.htm">SenseRegion</a> section of the manual.</p>
<hr>
<p>It is now possible to compile adv3Lite games for use with the <a href="webui.htm">WebUI</a> (i.e. for playing on-line via a browser).</p>
<hr>
<p>Mainly to support the WebUI, a number of <a href="webui.htm#inputmanager">inputManager</a> methods have been implemented (which are analogous to their adv3 counterparts). It is recommended that you always use these rather than the interpreter console i/o function equivalents. Note that in the adv3Lite version of these methods, there is no need to supply any arguments to inputManager.getInputLine() or inputManager.getKey() (since adv3Lite does not support real-time processing). </p>
<hr>
<p>The Parser's <a href="actionoverview.htm#default">DefaultAction</a> (for a command that consists purely of a noun) has been changed to the new ExamineOrGoToAction. This works exactly like the Examine action unless (a) the noun entered by the player is a room known to the player character; (b) the player character is not already in that room; and (c) the pathfind module is included in the build. If all these three conditions are fulfilled the ExamineOrGoTo action behaves like a GoTo action, thereby allowing the player to navigate the map just by entering the name of the location s/he wants the player character to head towards.</p>
<hr>
<p>The default value of <strong>GameMainDef.storeWholeObjectTable</strong> has been changed to true, since this is the safer option, and the memory requirement of storing the complete object table is unlikely to be an issue on a modern computer. If it is set to nil an additional setting now comes into effect: <strong>objTablePreinit.lookInMethods</strong>. If this is nil (the default), then objTablePreinit won't attempt to execute code (i.e. methods) to find conversation <a href="tags.htm">tags</a> indicating objects it needs to store in the object table; this is the safer option since executing methods out of context at preinit can easily cause run-time errors. For now, lookInMethods can be set to true to restore the previous behaviour, but this should be regarded as provisionally deprecated.</p>
<hr>
<p>The library preinit now marks the player character's immediate contents as known to the player character. This avoids the otherwise seemingly odd situation whereby a player familiar with the game tries to refer to something the player character is holding in conversation and it's not recognized by the parser as a valid topic (because the player has not yet taken inventory or performed any other action that would normally mark what the player character is holding as seen or known).</p>
<hr>
<p>A minor change has been made to the way the <a href="thing.htm#hidden">hiddenUnder and hiddenBehind</a> properties work. The new thing properties <strong>autoTakeOnLookUnder</strong> and <strong>autoTakeOnLookBehind</strong> allow you to specify that anything hidden under or behind the object in question should be taken by the actor when s/he looks under or behind it. If a look behind or look command action results in one or more objects being moved into the location of the object that has just been looked under/behind, then the message displayed now makes it clearer that the objects that have just been moved have been left in plain sight (rather than remaining concealed under or behind something else).</p>
<hr>
<p>An objOpen PreCondition has been added. This isn't (currently) used in the library (which uses containerOpen) but might prove useful to some game code.</p>
<hr>
<p>The documentation of the <a href="thing.htm">Thing</a> class now explains the use of the <strong>owner</strong> and <strong>ownsContents</strong> properties. These properties were present before but weren't previously documented in the manual.</p>
<hr>
<p>The setRevealed(tag) method of conversationManager so that the notification of other actors when a &lt;.revealed&gt; tag now only takes place when there's a respondingActor (i.e., when the &lt;.revealed&gt; tag is used in conversation). This corrects a bug whereby using a &lt;.reveal&gt; tag outside a conversation (e.g. to have an object description set a flag to trigger some other event) would cause a run-time error.</p>
<hr>
<p>The message "You find nothing of interest under the whatever" has been corrected (it did not display correctly before).</p>
<hr>
<p>Bug fixed whereby the player character's enclosing room was declared to be not visible when attempting to examine it.</p>
<hr>
<p>Bug fixed whereby the default action (i.e. entering a noun without a verb as a command) was taken to be a conversational command just after the current interlocutor had gone out of scope. </p>
<hr>
<p>Bug fixed whereby using a &lt;.convnode&gt; tag while a Conversation Node is active leaves the first Conversation Node still active (while activating the second one as well). A &lt;.convnode&gt; tag now overwrites the effect of any &lt;.convnode&gt; tag issued on a previous turn.</p>
<hr>
<p>Bug fixed in which the name of canEndConversation() method of ActorState was mis-spelled, so that ActorStates always tried to prevent conversations ending by default (since the non-existent method was deemed to be returning nil).</p>
<hr>
<p>Bugs fixed whereby a conversational command that triggered an implicit greeting would display a spurious "The x does not respond" message when no HelloTopic was found, or when a conversation was ended implicitly and no ByeTopic was found.</p>
<hr>
<p>Bugs fixed whereby HELLO and BYE commands (not explicitly directed to a specific actor) might either result in no response at all, or the response "The [cobj] does not respond" (where [cobj] should have been the name of the actor in question).</p>
<hr>
<p>Bug fixed in which the condition for deciding whether a SimpleAttachable should be listed separately was the wrong way round.</p>
</div>
<hr class="navb"><div class="navb">
<i>adv3Lite Library Manual</i><br>
<a class="nav" href="toc.htm">Table of Contents</a> | 
<a class="nav" href="final.htm">Final Moves</a> &gt; 
Change Log
<br><span class="navnp"><a class="nav" href="conclusion.htm"><i>Prev:</i> Conclusion</a> &nbsp;&nbsp;&nbsp;<a class="nav" href="manual_idx.html"><i>Next:</i> Index</a> &nbsp;&nbsp;&nbsp;  </span>

</div>


</body>
</html>